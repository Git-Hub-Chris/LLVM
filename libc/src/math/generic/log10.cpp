//===-- Double-precision log10(x) function --------------------------------===//
//
// Part of the LLVM Project, under the Apache License v2.0 with LLVM Exceptions.
// See https://llvm.org/LICENSE.txt for license information.
// SPDX-License-Identifier: Apache-2.0 WITH LLVM-exception
//
//===----------------------------------------------------------------------===//

#include "src/math/log10.h"
#include "src/__support/FPUtil/FEnvImpl.h"
#include "src/__support/FPUtil/FPBits.h"
#include "src/__support/FPUtil/PolyEval.h"
#include "src/__support/FPUtil/double_double.h"
#include "src/__support/FPUtil/dyadic_float.h"
#include "src/__support/FPUtil/multiply_add.h"
#include "src/__support/common.h"
#include "src/__support/integer_literals.h"
#include "src/__support/macros/optimization.h" // LIBC_UNLIKELY

#include "common_constants.h"
#include "log_range_reduction.h"

namespace LIBC_NAMESPACE {

// 128-bit precision dyadic floating point numbers.
using Float128 = typename fputil::DyadicFloat<128>;
using Sign = fputil::Sign;
using LIBC_NAMESPACE::operator""_u128;

namespace {

constexpr fputil::DoubleDouble LOG10_E = {0x1.95355baaafad3p-57,
                                          0x1.bcb7b1526e50ep-2};

// A simple upper bound for the error of e_x * log(2) - log(r).
constexpr double HI_ERR = 0x1.0p-85;

// Extra errors from P is from using x^2 to reduce evaluation latency.
constexpr double P_ERR = 0x1.0p-51;

// log10(2) with 128-bit prepcision generated by SageMath with:
//   sage: (s, m, e) = RealField(128)(2).log10().sign_exponent_mantissa();
//   sage: print("hex(m), "_u128");
const Float128 LOG10_2(Sign::POS, /*exponent=*/-129, /*mantissa=*/
                       0x9a209a84fbcff7988f8959ac0b7c9178_u128);

const LogRR LOG10_TABLE = {
    // -log10(r) with 128-bit precision generated by SageMath with:
    //
    // for i in range(128):
    //   r = 2^-8 * ceil( 2^8 * (1 - 2^(-8)) / (1 + i*2^(-7)) );
    //   s, m, e = RealField(128)(r).log10().sign_mantissa_exponent();
    //   print("{Sign::POS,", e, ", hex(m), "_u128},");
    /* .step_1 = */ {
        {Sign::POS, 0, 0_u128},
        {Sign::POS, -136, 0xdf3b5ebbda7e186b65af394fe05eafd3_u128},
        {Sign::POS, -135, 0xe01d40572f029c16a8fb8d87b30163b5_u128},
        {Sign::POS, -134, 0xa8c1263ac3f57eb36bb0170e5bb5d630_u128},
        {Sign::POS, -134, 0xe1e841bbc26204e5fc2ea6eb0ea1370e_u128},
        {Sign::POS, -133, 0x8dc2eb02274d6ff4dc8a199a4bb63382_u128},
        {Sign::POS, -133, 0xaacde920361dd05486b57ea610c7db33_u128},
        {Sign::POS, -133, 0xc81618eb15421bab5f034a40e6a2f09d_u128},
        {Sign::POS, -133, 0xe59c7e66c5fedb4b594a31b2c5cc891c_u128},
        {Sign::POS, -133, 0xf477584f97b654de221efda58221904b_u128},
        {Sign::POS, -132, 0x892e821975106e0968a0dc47567691c9_u128},
        {Sign::POS, -132, 0x9841c66e17dfe7da10bc94f44d216b49_u128},
        {Sign::POS, -132, 0x9fd7be3318306cc5e303ea7e23c9d6fb_u128},
        {Sign::POS, -132, 0xaf1cb35bf494a8ddce697dbaa00d4c7d_u128},
        {Sign::POS, -132, 0xbe8380a2fa7eba5a9c216079dcf0ea96_u128},
        {Sign::POS, -132, 0xc643c7758283a27175278940eecfc3a9_u128},
        {Sign::POS, -132, 0xd5de75ec27e4fe682d3467d253e2d1fc_u128},
        {Sign::POS, -132, 0xddb904e8f1272a95ead4055dcdec7b22_u128},
        {Sign::POS, -132, 0xed88f6bb355fa196e1e0dda0b3d375a4_u128},
        {Sign::POS, -132, 0xf57e8281ade9d92d38dc40c4fe11e608_u128},
        {Sign::POS, -131, 0x82c2941bb20bbe1f3bcdcfe7b23976cd_u128},
        {Sign::POS, -131, 0x86cb36632807cdcd456350b0bda452a6_u128},
        {Sign::POS, -131, 0x8eeaa306458b760a78185dcc37fda01a_u128},
        {Sign::POS, -131, 0x9301839512fc1168307643adbbbde1b3_u128},
        {Sign::POS, -131, 0x9b3dd1d550c414436c449d409f883fe3_u128},
        {Sign::POS, -131, 0x9f6356aa03c343898ea7b30c8b4ad886_u128},
        {Sign::POS, -131, 0xa7bd56cdde5d76a2961c6e690d8879b4_u128},
        {Sign::POS, -131, 0xabf1ea3e1d7bd7cf042643ced81ec14a_u128},
        {Sign::POS, -131, 0xb02b9af74c2f879e4742fb3d0b5cdd19_u128},
        {Sign::POS, -131, 0xb8ae8671b3d7dd6cf7e2ab36f09e9014_u128},
        {Sign::POS, -131, 0xbcf7dabd87c01afc8d3fc63485e7ff13_u128},
        {Sign::POS, -131, 0xc1467f694d10a581f3edc49375fbc5a5_u128},
        {Sign::POS, -131, 0xc9f3ef07e1f3fc5e5fcd7d0ce937375f_u128},
        {Sign::POS, -131, 0xce52d50b94fa253a58252dada9f06111_u128},
        {Sign::POS, -131, 0xd2b74192fae4377762f01e5ff43708ab_u128},
        {Sign::POS, -131, 0xd72142a84ca85abd481d9b3131f52639_u128},
        {Sign::POS, -131, 0xdb90e68b8abf14afb305ced1419fe924_u128},
        {Sign::POS, -131, 0xe48150cf32888b9c849266a85513dc6d_u128},
        {Sign::POS, -131, 0xe90234c65a15e533080ecf3266b4dcf4_u128},
        {Sign::POS, -131, 0xed88f6bb355fa196e1e0dda0b3d375a4_u128},
        {Sign::POS, -131, 0xf215a60b6557943fce3537a3a211b25b_u128},
        {Sign::POS, -131, 0xf6a852513757dfbd5dab68307fedefcd_u128},
        {Sign::POS, -131, 0xffdfe15de3c01bac1be2585c279c50a5_u128},
        {Sign::POS, -130, 0x8242724a155219f318aa302171017dcb_u128},
        {Sign::POS, -130, 0x849812d0ccbb5cbdabc7e698502d43c0_u128},
        {Sign::POS, -130, 0x86f0dab1ab5822b6c339089a51663370_u128},
        {Sign::POS, -130, 0x894cd27d9f182c6326f70b34ce5cf201_u128},
        {Sign::POS, -130, 0x8bac02e8ac3e09ac676f20a87ab433df_u128},
        {Sign::POS, -130, 0x8e0e74caae062e246db4169cc4b83bc3_u128},
        {Sign::POS, -130, 0x907431201c7f651acd3fdb2fad0d1fd6_u128},
        {Sign::POS, -130, 0x92dd410ad7bfe10349d03e163250d1d4_u128},
        {Sign::POS, -130, 0x9549add2f8a3c7e09ec7dc02d5e723b9_u128},
        {Sign::POS, -130, 0x97b980e7a743d71c34698d03a5442573_u128},
        {Sign::POS, -130, 0x9a2cc3dff75485560522904d1e47f3de_u128},
        {Sign::POS, -130, 0x9ca3807bca9fe93f791a72646c87b976_u128},
        {Sign::POS, -130, 0x9f1dc0a4b9cea2863826f190d655d736_u128},
        {Sign::POS, -130, 0xa19b8e6f03b60e45544ab3e48199b299_u128},
        {Sign::POS, -130, 0xa41cf41a83643487be775fa82961114e_u128},
        {Sign::POS, -130, 0xa6a1fc13ad24195345798e5019e6c082_u128},
        {Sign::POS, -130, 0xa92ab0f492b772bd91fb1ed0cdc4d1fb_u128},
        {Sign::POS, -130, 0xabb71d85ef05380d818b8b9cbbd17b72_u128},
        {Sign::POS, -130, 0xae474cc0397f0d4fa50c2fea60c5b3b2_u128},
        {Sign::POS, -130, 0xb0db49ccc1823c8e58ea34980ad8b720_u128},
        {Sign::POS, -130, 0xb3732006d1fbbba54b5f71941be508a4_u128},
        {Sign::POS, -130, 0xb60edafcdd99ad1d9e405fb8bcb1ff1e_u128},
        {Sign::POS, -130, 0xb60edafcdd99ad1d9e405fb8bcb1ff1e_u128},
        {Sign::POS, -130, 0xb8ae8671b3d7dd6cf7e2ab36f09e9014_u128},
        {Sign::POS, -130, 0xbb522e5dbf37f63bc669639640c305bb_u128},
        {Sign::POS, -130, 0xbdf9def04cf980ffa3dc9e464e98764b_u128},
        {Sign::POS, -130, 0xc0a5a490dea95b5effd3256b59fa9c59_u128},
        {Sign::POS, -130, 0xc3558be085e3f4bcb0a2d48672a051a5_u128},
        {Sign::POS, -130, 0xc3558be085e3f4bcb0a2d48672a051a5_u128},
        {Sign::POS, -130, 0xc609a1bb4aa98f59acb2ca5d4ca1c10e_u128},
        {Sign::POS, -130, 0xc8c1f3399ca7d33b43690b9e3cde0d02_u128},
        {Sign::POS, -130, 0xcb7e8db1cfe0482718b1fd60383f7e5a_u128},
        {Sign::POS, -130, 0xce3f7eb9a517c9690248757e5f45af3d_u128},
        {Sign::POS, -130, 0xd104d427de7fbcc47c4acd605be48bc1_u128},
        {Sign::POS, -130, 0xd104d427de7fbcc47c4acd605be48bc1_u128},
        {Sign::POS, -130, 0xd3ce9c15e10ec92758ff63629a92652d_u128},
        {Sign::POS, -130, 0xd69ce4e16303fcdd6b49be3bd8c89f10_u128},
        {Sign::POS, -130, 0xd96fbd2e2814c9cce6dd603a881e9060_u128},
        {Sign::POS, -130, 0xd96fbd2e2814c9cce6dd603a881e9060_u128},
        {Sign::POS, -130, 0xdc4733e7cbcbfc8c89e281c98c1d705c_u128},
        {Sign::POS, -130, 0xdf2358439aa5dd12dc0db7cf0cce9f32_u128},
        {Sign::POS, -130, 0xe20439c27a7c01b8fdf1c5b846db9deb_u128},
        {Sign::POS, -130, 0xe20439c27a7c01b8fdf1c5b846db9deb_u128},
        {Sign::POS, -130, 0xe4e9e832e2da0c053dd7eab48869c402_u128},
        {Sign::POS, -130, 0xe7d473b2e5db8f2a4e8fcc900b41daef_u128},
        {Sign::POS, -130, 0xe7d473b2e5db8f2a4e8fcc900b41daef_u128},
        {Sign::POS, -130, 0xeac3ecb24a3ac7b47593e1a9e917359a_u128},
        {Sign::POS, -130, 0xedb863f4b73f982de7741396b49e1ce5_u128},
        {Sign::POS, -130, 0xedb863f4b73f982de7741396b49e1ce5_u128},
        {Sign::POS, -130, 0xf0b1ea93f34675a7c8ba4f8f47b85a5c_u128},
        {Sign::POS, -130, 0xf3b09202359f97877007c1276821b705_u128},
        {Sign::POS, -130, 0xf3b09202359f97877007c1276821b705_u128},
        {Sign::POS, -130, 0xf6b46c0c8c8fdea17ee19afe6db7e324_u128},
        {Sign::POS, -130, 0xf9bd8add584687f0edf54f37f6d40420_u128},
        {Sign::POS, -130, 0xf9bd8add584687f0edf54f37f6d40420_u128},
        {Sign::POS, -130, 0xfccc00fedba4e6fbefe52ccf03e7dee1_u128},
        {Sign::POS, -130, 0xffdfe15de3c01bac1be2585c279c50a5_u128},
        {Sign::POS, -130, 0xffdfe15de3c01bac1be2585c279c50a5_u128},
        {Sign::POS, -129, 0x817c9fa643880404e0b571f5c91b0446_u128},
        {Sign::POS, -129, 0x830c17427ea55eca7178594bef2def59_u128},
        {Sign::POS, -129, 0x830c17427ea55eca7178594bef2def59_u128},
        {Sign::POS, -129, 0x849e6196487c1d1c9a741bb171158d2a_u128},
        {Sign::POS, -129, 0x849e6196487c1d1c9a741bb171158d2a_u128},
        {Sign::POS, -129, 0x863388eb55ebd2951a618264446cb495_u128},
        {Sign::POS, -129, 0x87cb97c3ff9eac1871dbdbbec51d7657_u128},
        {Sign::POS, -129, 0x87cb97c3ff9eac1871dbdbbec51d7657_u128},
        {Sign::POS, -129, 0x896698dce4cff76cabe0b522230f7d14_u128},
        {Sign::POS, -129, 0x896698dce4cff76cabe0b522230f7d14_u128},
        {Sign::POS, -129, 0x8b04972e9d4d3011d28e8adafea703b4_u128},
        {Sign::POS, -129, 0x8ca59def7b5cefc5208422d83be34b27_u128},
        {Sign::POS, -129, 0x8ca59def7b5cefc5208422d83be34b27_u128},
        {Sign::POS, -129, 0x8e49b8955e3ffb8ac385cf49402af0e4_u128},
        {Sign::POS, -129, 0x8e49b8955e3ffb8ac385cf49402af0e4_u128},
        {Sign::POS, -129, 0x8ff0f2d7960a075cda982a614e12c6dd_u128},
        {Sign::POS, -129, 0x8ff0f2d7960a075cda982a614e12c6dd_u128},
        {Sign::POS, -129, 0x919b58b0d999bbc8038401fc1c1b5c2c_u128},
        {Sign::POS, -129, 0x919b58b0d999bbc8038401fc1c1b5c2c_u128},
        {Sign::POS, -129, 0x9348f6614f821394a9b55d3f16da746a_u128},
        {Sign::POS, -129, 0x9348f6614f821394a9b55d3f16da746a_u128},
        {Sign::POS, -129, 0x94f9d870aac256a5088d2d1473d4f7f5_u128},
        {Sign::POS, -129, 0x94f9d870aac256a5088d2d1473d4f7f5_u128},
        {Sign::POS, -129, 0x96ae0bb05c35d5bd7c1e117dea19e9e6_u128},
        {Sign::POS, -129, 0x96ae0bb05c35d5bd7c1e117dea19e9e6_u128},
        {Sign::POS, -129, 0x98659d3dd9b12532336db0630f536fb9_u128},
        {Sign::POS, 0, 0_u128},
    },
    // -log10(r) for the second step, generated by SageMath with:
    //
    // for i in range(-2^6, 2^7 + 1):
    //   r = 2^-16 * round( 2^16 / (1 + i*2^(-14)) );
    //   s, m, e = RealField(128)(r).log10().sign_mantissa_exponent();
    //   print("{Sign::POS," if s == -1 else "{Sign::NEG,", e, ",
    //         hex(m), "_u128},");
    /* .step_2 = */
    {
        {Sign::NEG, -137, 0xdeca729013cd7c317f1ce002fa34131b_u128},
        {Sign::NEG, -137, 0xdb5475b44946d986639afa085dd8b4c7_u128},
        {Sign::NEG, -137, 0xd7de6b0e10cab7d205512632fe9a58cb_u128},
        {Sign::NEG, -137, 0xd468529cfc6fb395b5380a9953117d07_u128},
        {Sign::NEG, -137, 0xd0f22c609e47474170af2d7d53be1f31_u128},
        {Sign::NEG, -137, 0xcd7bf858885dcae20ccd499c49b74cc2_u128},
        {Sign::NEG, -137, 0xca05b6844cba73cf5b51ddc3987ebfb8_u128},
        {Sign::NEG, -137, 0xc68f66e37d5f545a49375f5189b3782b_u128},
        {Sign::NEG, -137, 0xc3190975ac495b7af6e57738865c712f_u128},
        {Sign::NEG, -137, 0xbfa29e3a6b70547eca02b10a8c712acd_u128},
        {Sign::NEG, -137, 0xbc2c25314cc6e6b678e5038210208151_u128},
        {Sign::NEG, -137, 0xb8b59e59e23a95240fa099ecd71ee0ea_u128},
        {Sign::NEG, -137, 0xb53f09b3bdb3be28eeb445ccb8fb09ed_u128},
        {Sign::NEG, -137, 0xb1c8673e71159b33c352fff18a1c02fb_u128},
        {Sign::NEG, -137, 0xae51b6f98e3e406e7949e03ecf9b390b_u128},
        {Sign::NEG, -137, 0xaadaf8e4a7069c6c2681f33f30aadedc_u128},
        {Sign::NEG, -137, 0xa7642cff4d4277d6f01d5496eea213b3_u128},
        {Sign::NEG, -137, 0xa3ed534912c0751de92ef555ff1de975_u128},
        {Sign::NEG, -137, 0xa0766bc1894a1022eb0c7519b3e7c1e0_u128},
        {Sign::NEG, -137, 0x9c21b6e91e7f03a3f60d204ff0fe5296_u128},
        {Sign::NEG, -137, 0x98aab0491050bea8125c19a4f057c18b_u128},
        {Sign::NEG, -137, 0x95339bd64cd953e77e9383ce1bdf9575_u128},
        {Sign::NEG, -137, 0x91bc799065cc57d6bf274f4d8f770253_u128},
        {Sign::NEG, -137, 0x8e454976ecd836ad656bd9b758fe44ba_u128},
        {Sign::NEG, -137, 0x8ace0b8973a63413bfdd2c7f388fc014_u128},
        {Sign::NEG, -137, 0x8756bfc78bda6ad083fbf6ed936c493a_u128},
        {Sign::NEG, -137, 0x83df6630c713cc7671bfa9a18bec01cc_u128},
        {Sign::NEG, -137, 0x8067fec4b6ec2111f09d19f56dbfef72_u128},
        {Sign::NEG, -138, 0xf9e11305d9f00dad4c422713b1642228_u128},
        {Sign::NEG, -138, 0xf2f20cd5f58de39a0c3c7c5699b7a0a4_u128},
        {Sign::NEG, -138, 0xec02eaf8e3c656ffb8db7c69e3fa0797_u128},
        {Sign::NEG, -138, 0xe513ad6dc7a3a553a083eb05506ff7ed_u128},
        {Sign::NEG, -138, 0xde245433c425b5c5c21595e745f1fa15_u128},
        {Sign::NEG, -138, 0xd734df49fc42189bb9d5bcdbfe719389_u128},
        {Sign::NEG, -138, 0xd0454eaf92e4068ba17a1e85e93461f4_u128},
        {Sign::NEG, -138, 0xc955a263aaec6016e3537584da333fda_u128},
        {Sign::NEG, -138, 0xc265da656731ace500963177f24682c2_u128},
        {Sign::NEG, -138, 0xbb75f6b3ea801b1e4ac037347bcfc50e_u128},
        {Sign::NEG, -138, 0xb485f74e57997ec6901a736a4364cdfd_u128},
        {Sign::NEG, -138, 0xad95dc33d1355117bb550acc3b9d7247_u128},
        {Sign::NEG, -138, 0xa6a5a5637a00afdc663cf2b27e8f1ffb_u128},
        {Sign::NEG, -138, 0x9fb552dc749e5cca5f89bd08feb39952_u128},
        {Sign::NEG, -138, 0x98c4e49de3a6bcdd23c2623c73f494db_u128},
        {Sign::NEG, -138, 0x91d45aa6e9a7d7b04937d3b5485af61e_u128},
        {Sign::NEG, -138, 0x8ae3b4f6a92556d9df14214e7a6d8111_u128},
        {Sign::NEG, -138, 0x83f2f38c44988544bf7cfc14999fb4bc_u128},
        {Sign::NEG, -139, 0xfa042ccdbce09d15a990c0ee569a8d51_u128},
        {Sign::NEG, -139, 0xec223b0b32227c9ea38463e9d941e1c2_u128},
        {Sign::NEG, -139, 0xde4011cf2daaff31ba0324530edaa03f_u128},
        {Sign::NEG, -139, 0xd05db117f419b8575e997a02dad7ace7_u128},
        {Sign::NEG, -139, 0xc27b18e3c9f977c74a14676d4d0f817e_u128},
        {Sign::NEG, -139, 0xb4984930f3c0481c857c002ee7a1e473_u128},
        {Sign::NEG, -139, 0xa6b541fdb5cf6d895923b2eb72d8012a_u128},
        {Sign::NEG, -139, 0x98d203485473648b21cde8f85ca1f9fd_u128},
        {Sign::NEG, -139, 0x8aee8d0f13e3e09e0be08e08b1d212d4_u128},
        {Sign::NEG, -140, 0xfa15bea0708795e1695023998e6bd7b0_u128},
        {Sign::NEG, -140, 0xde4df4140b42822f634cea6750617a92_u128},
        {Sign::NEG, -140, 0xc285ba757feb2781fbd7e970aef9dbb8_u128},
        {Sign::NEG, -140, 0xa6bd11c1564a8ace9aedc1c1ba7d0695_u128},
        {Sign::NEG, -140, 0x8af3f9f41600120a8d306ba207233c44_u128},
        {Sign::NEG, -141, 0xde54e6148d030322856a0a3a00fcf3c1_u128},
        {Sign::NEG, -141, 0xa6c0fa00de35f314b3a2c1407cf6d38d_u128},
        {Sign::NEG, -142, 0xde585f4c5bbbcd3dd791cf6a70c3a504_u128},
        {Sign::NEG, -143, 0xde5a1bf627b1f68f10a633f2c4a8ea22_u128},
        {Sign::NEG, 0, 0_u128},
        {Sign::POS, -143, 0xde5d95658a729eabed4a68e5e6e83ddf_u128},
        {Sign::POS, -142, 0xde5f522b21e3e25a3281f1872cdbee94_u128},
        {Sign::POS, -141, 0xa6c8cb3b7e5bbbfdf1466edaa96e356e_u128},
        {Sign::POS, -141, 0xde62cbd21e8954738a607fd695dfc3d9_u128},
        {Sign::POS, -140, 0x8afed57032bebc7cc36b8713ceefe2de_u128},
        {Sign::POS, -140, 0xa6ccb436a3c72fa45c2e76c953e3e3e6_u128},
        {Sign::POS, -140, 0xc29b023fdcb2dccf8e4950fa5c943bbf_u128},
        {Sign::POS, -140, 0xde69bf8f58005dfc20fa8a73c585f634_u128},
        {Sign::POS, -140, 0xfa38ec28905810a30aa106d9b0a9717a_u128},
        {Sign::POS, -139, 0x8b04440780460c2a85d70e032de41aec_u128},
        {Sign::POS, -139, 0x98ec49a311cc30abbeee21cbb82a9a78_u128},
        {Sign::POS, -139, 0xa6d486e8ba5151a0abd7b0fdd8efe6f6_u128},
        {Sign::POS, -139, 0xb4bcfbda377d31cc3221c56e2c1aa912_u128},
        {Sign::POS, -139, 0xc2a5a879470c7c3757b795a36d9c5f19_u128},
        {Sign::POS, -139, 0xd08e8cc7a6d0c580131ec142c053ac3b_u128},
        {Sign::POS, -139, 0xde77a8c714b08d2835e3298f4bb2aa0a_u128},
        {Sign::POS, -139, 0xec60fc794ea73ee47133dafdfc44f160_u128},
        {Sign::POS, -139, 0xfa4a87e012c533eb74b37d23121c59d5_u128},
        {Sign::POS, -138, 0x841a257e8f97da2293bf5f4207da8a4c_u128},
        {Sign::POS, -138, 0x8b0f22e919107c0cfdb5990ec6057f4e_u128},
        {Sign::POS, -138, 0x92043c3084f414812d408a58b1b202fe_u128},
        {Sign::POS, -138, 0x98f97155b274b1ab1759381b61dfbf01_u128},
        {Sign::POS, -138, 0x9feec25980cedbbe41e90a054df4b9f1_u128},
        {Sign::POS, -138, 0xa6e42f3ccf49959da1e66c6203725d50_u128},
        {Sign::POS, -138, 0xadd9b8007d365d838693d36ab45bd7ce_u128},
        {Sign::POS, -138, 0xb4cf5ca569f12da991e25bb40ad3f098_u128},
        {Sign::POS, -138, 0xbbc51d2c74e07cf0bdf94392c4cc7f6c_u128},
        {Sign::POS, -138, 0xc2baf9967d753f896fe37973354a82f9_u128},
        {Sign::POS, -138, 0xc9b0f1e4632ae79b97647b4267bfd801_u128},
        {Sign::POS, -138, 0xd0a70617058765eedbf5c32a454f7bdf_u128},
        {Sign::POS, -138, 0xd79d362f441b2a92d6edfe04c37ba916_u128},
        {Sign::POS, -138, 0xde93822dfe8125875ad3480ccfbe9890_u128},
        {Sign::POS, -138, 0xe589ea14145ec764c7d9ac765be7e325_u128},
        {Sign::POS, -138, 0xec806de2656402046d8f24b9a3ca011b_u128},
        {Sign::POS, -138, 0xf3770d99d14b4928f9b654807dcdd5b2_u128},
        {Sign::POS, -138, 0xfa6dc93b37d99326f4513f4745663028_u128},
        {Sign::POS, -137, 0x80b25063bc6f2cc6a46e9a72d80da75f_u128},
        {Sign::POS, -137, 0x842dca1fba19cce6ee60992b51ffac4b_u128},
        {Sign::POS, -137, 0x87a951d204deeaf31977fa1c786886b3_u128},
        {Sign::POS, -137, 0x8b24e77b0cb60a840e5f7c52cdf119d5_u128},
        {Sign::POS, -137, 0x8ea08b1b419bf2213bf9d70da1021a10_u128},
        {Sign::POS, -137, 0x921c3cb31392ab94fd0406b07523b8e6_u128},
        {Sign::POS, -137, 0x9597fc42f2a184410453ee32c020f2a8_u128},
        {Sign::POS, -137, 0x9913c9cb4ed50d72cfb3ec22066bf7f6_u128},
        {Sign::POS, -137, 0x9c8fa54c983f1cb8215c025bd493ecf9_u128},
        {Sign::POS, -137, 0x9f2c93192e68232b39c116b7ee3a83ec_u128},
        {Sign::POS, -137, 0xa2a8870f24ac5f66f41f4b3ede2782f0_u128},
        {Sign::POS, -137, 0xa62488ff3c73579961196927723eb75c_u128},
        {Sign::POS, -137, 0xa9a098e9e5e2a4320e615e836cb1edab_u128},
        {Sign::POS, -137, 0xad1cb6cf912523726981331c5fc71cfc_u128},
        {Sign::POS, -137, 0xb098e2b0ae6af9c25f6a4faa054f11fa_u128},
        {Sign::POS, -137, 0xb4151c8dade9920502a68bc681a74c28_u128},
        {Sign::POS, -137, 0xb7916466ffdb9ded382ba24d90566403_u128},
        {Sign::POS, -137, 0xbb0dba3d148116526ad1abe51dd22e00_u128},
        {Sign::POS, -137, 0xbe8a1e105c1f3b85456d3f7f59b13960_u128},
        {Sign::POS, -137, 0xc2068fe1470095a4738dd8b7d66e9058_u128},
        {Sign::POS, -137, 0xc5830fb04574f4f168e123fed7ff11c6_u128},
        {Sign::POS, -137, 0xc8ff9d7dc7d172252f3bd09780c3aa11_u128},
        {Sign::POS, -137, 0xcc7c394a3e706ec53b48887f1ce36935_u128},
        {Sign::POS, -137, 0xcff8e31619b1957847ddae655ecc4633_u128},
        {Sign::POS, -137, 0xd3759ae1c9f9da5b37fa81eef4819c88_u128},
        {Sign::POS, -137, 0xd6f260adbfb37b55ff6c4a8d747c65ed_u128},
        {Sign::POS, -137, 0xda6f347a6b4e0070921c29493a33318c_u128},
        {Sign::POS, -137, 0xddec16483d3e3c27da0631eb65e731d8_u128},
        {Sign::POS, -137, 0xe1690617a5fe4bc2b3da6c07d110babc_u128},
        {Sign::POS, -137, 0xe4e603e9160d97a6f2485c7868b8835a_u128},
        {Sign::POS, -137, 0xe8630fbcfdf0d3ae67f5b7ed01344055_u128},
        {Sign::POS, -137, 0xebe02993ce31ff7bf820df445b1d0622_u128},
        {Sign::POS, -137, 0xef5d516df76066d0adefc674b7eca5cd_u128},
        {Sign::POS, -137, 0xf2da874bea10a1e0da6be6dc057d3235_u128},
        {Sign::POS, -137, 0xf657cb2e16dc95a9392bdde152ab5ff5_u128},
        {Sign::POS, -137, 0xf9d51d14ee6374441bab58e2ec99cf73_u128},
        {Sign::POS, -137, 0xfd527d00e149bd3e9b51ef7e3388d692_u128},
        {Sign::POS, -136, 0x8067f579301c9ef6e914c6a7f3f22fa2_u128},
        {Sign::POS, -136, 0x8226b374edf088e20d22862eb2081c94_u128},
        {Sign::POS, -136, 0x83e57873e27ad15329ebd0b476cd8fd8_u128},
        {Sign::POS, -136, 0x85a44476461854a098feddc2806d01ed_u128},
        {Sign::POS, -136, 0x8763177c512896af471bfc261a401854_u128},
        {Sign::POS, -136, 0x88b23a5b61430a16b6f89c19b4cd1acd_u128},
        {Sign::POS, -136, 0x8a7119a85909ebe9b39aaf34163fb099_u128},
        {Sign::POS, -136, 0x8c2ffff99357e8871665f0f821541c36_u128},
        {Sign::POS, -136, 0x8deeed4f489679a6a5051754e049c1cb_u128},
        {Sign::POS, -136, 0x8fade1a9b131c1598c5a9a1c57b2e986_u128},
        {Sign::POS, -136, 0x916cdd0905988a351d8448438a26a9ae_u128},
        {Sign::POS, -136, 0x932bdf6d7e3c477d8e3a0913ecd2fd02_u128},
        {Sign::POS, -136, 0x94eae8d753911550bc881a45f47f1d36_u128},
        {Sign::POS, -136, 0x96a9f946be0db8d0f5e51c05499b06d0_u128},
        {Sign::POS, -136, 0x986910bbf62ba04fc1a43be81a243fde_u128},
        {Sign::POS, -136, 0x9a282f373466e378aec3cfebe971beb7_u128},
        {Sign::POS, -136, 0x9be754b8b13e437c2518b29328614989_u128},
        {Sign::POS, -136, 0x9da68140a5332b3a39d6b147cbe803a4_u128},
        {Sign::POS, -136, 0x9f65b4cf48c9af6d87765e3004ae428d_u128},
        {Sign::POS, -136, 0xa124ef64d4888ed608f896ab28245bac_u128},
        {Sign::POS, -136, 0xa2e4310180f93263f8880fb5ca630c87_u128},
        {Sign::POS, -136, 0xa4a379a586a7ad62b179397cf82e935c_u128},
        {Sign::POS, -136, 0xa662c9511e22bda395a8cb717197ad81_u128},
        {Sign::POS, -136, 0xa82220047ffbcba8f6394a34b7f9a4a4_u128},
        {Sign::POS, -136, 0xa9e17dbfe4c6ead0ffafd8c2b57884e8_u128},
        {Sign::POS, -136, 0xaba0e283851ad980a970a643b8a6ac2b_u128},
        {Sign::POS, -136, 0xad604e4f9991014ea89b49fb749d47e0_u128},
        {Sign::POS, -136, 0xaf1fc1245ac5772e66475ed2ac983305_u128},
        {Sign::POS, -136, 0xb06f5be1bf1918e7b4fd6209364bb36f_u128},
        {Sign::POS, -136, 0xb22edb0636da31d68b5ce79b0965962a_u128},
        {Sign::POS, -136, 0xb3ee6133f71497696724232b07396427_u128},
        {Sign::POS, -136, 0xb5adee6b386e62ae2f02b14dcad8a49c_u128},
        {Sign::POS, -136, 0xb76d82ac339058dbbd6443a81f792e07_u128},
        {Sign::POS, -136, 0xb92d1df72125eb7cea1cd9625749939a_u128},
        {Sign::POS, -136, 0xbaecc04c39dd389b97775e3142198913_u128},
        {Sign::POS, -136, 0xbcac69abb6670aebc2a701b809a2bc39_u128},
        {Sign::POS, -136, 0xbe6c1a15cf76d9f6979b990f39e662e3_u128},
        {Sign::POS, -136, 0xc02bd18abdc2ca4588395c463ddd82b2_u128},
        {Sign::POS, -136, 0xc1eb900aba03ad8d66f451bd9ba5ed05_u128},
        {Sign::POS, -136, 0xc3ab5595fcf502d984cfb9413f6437a6_u128},
        {Sign::POS, -136, 0xc56b222cbf54f6b6d2c1c8d32943ca42_u128},
        {Sign::POS, -136, 0xc72af5cf39e4635f067c0d1fd95192e6_u128},
        {Sign::POS, -136, 0xc8ead07da566d0e3c298bf9edb6441f2_u128},
        {Sign::POS, -136, 0xcaaab2383aa27559c22d646addde3910_u128},
        {Sign::POS, -136, 0xcc6a9aff3260350407c301e5c7d1ca40_u128},
        {Sign::POS, -136, 0xce2a8ad2c56ba27f0fb444464df02505_u128},
        {Sign::POS, -136, 0xcfea81b32c92feec05f1df3591ae898f_u128},
        {Sign::POS, -136, 0xd13a7f7c07506f7db43caf8e7b891066_u128},
        {Sign::POS, -136, 0xd2fa82b36a610c4f597fb13f0d0fdf19_u128},
        {Sign::POS, -136, 0xd4ba8cf83dd2a06b3c21f1c60a60b0d6_u128},
        {Sign::POS, -136, 0xd67a9e4aba7d7ce52b7455909a0428a4_u128},
        {Sign::POS, -136, 0xd83ab6ab193ca2231438b60573d2da10_u128},
        {Sign::POS, -136, 0xd9fad61992edc00849f86400c5ab2b11_u128},
        {Sign::POS, -136, 0xdbbafc9660713620d3c313d148a23c35_u128},
        {Sign::POS, -136, 0xdd7b2a21baaa13ccbc56852355e0f0d5_u128},
    },
    // -log10(r) for the third step, generated by SageMath with:
    //
    // for i in range(-80, 81):
    //   r = 2^-21 * round( 2^21 / (1 + i*2^(-21)) );
    //   s, m, e = RealField(128)(r).log10().sign_mantissa_exponent();
    //   print("{Sign::POS," if (s == -1) else "{Sign::NEG,", e, ",
    //         hex(m), "_u128},");
    /* .step_3 = */
    {
        {Sign::NEG, -143, 0x8af8b9b322ba8c7d54d7e49898ca0093_u128},
        {Sign::NEG, -143, 0x893c06529deffc3dc321bbf16665f29c_u128},
        {Sign::NEG, -143, 0x877f52e433ac7ec48246df7140c3e4ae_u128},
        {Sign::NEG, -143, 0x85c29f67e3ef35bc1deaa9e85780e4c1_u128},
        {Sign::NEG, -143, 0x8405ebddaeb742cf0cd8a5121a9162d0_u128},
        {Sign::NEG, -143, 0x824938459403c7a7b10486fa4644308d_u128},
        {Sign::NEG, -143, 0x808c849f93d3e5f0578a2f61eedd4be8_u128},
        {Sign::NEG, -144, 0xfd9fa1d75c4d7ea6715b4a491790e8a7_u128},
        {Sign::NEG, -144, 0xfa263a53c5f6eaf4efb6273a04c71573_u128},
        {Sign::NEG, -144, 0xf6acd2b464a25420474d901560c17807_u128},
        {Sign::NEG, -144, 0xf3336af9384dfd7c6b9a5deceb80ec57_u128},
        {Sign::NEG, -144, 0xefba032240f82a5d2665a32f7cc64f79_u128},
        {Sign::NEG, -144, 0xec409b2f7e9f1e1617c8a67316659363_u128},
        {Sign::NEG, -144, 0xe8c73320f1411bfab62cdd3ef5c8673d_u128},
        {Sign::NEG, -144, 0xe54dcaf698dc675e4e4be6d5a4a07422_u128},
        {Sign::NEG, -144, 0xe1d462b0756f4394032f86ff08c92e22_u128},
        {Sign::NEG, -144, 0xde5afa4e86f7f3eece31a0d27359396f_u128},
        {Sign::NEG, -144, 0xdae191d0cd74bbc17efc3180aee36373_u128},
        {Sign::NEG, -144, 0xd768293748e3de5ebb894b1e0ce72fc4_u128},
        {Sign::NEG, -144, 0xd3eec081f9439f1900230f6c7270f8be_u128},
        {Sign::NEG, -144, 0xd07557b0de9241429f63aaa563e9a399_u128},
        {Sign::NEG, -144, 0xccfbeec3f8ce082dc2354e441015e7eb_u128},
        {Sign::NEG, -144, 0xc98285bb47f5372c67d22bcf5a452a4c_u128},
        {Sign::NEG, -144, 0xc6091c96cc06119065c46fa3e3afea18_u128},
        {Sign::NEG, -144, 0xc28fb35684fedaab67e63bbe1405c20d_u128},
        {Sign::NEG, -144, 0xbf1649fa72ddd5cef061a284212afbad_u128},
        {Sign::NEG, -144, 0xbb9ce08295a1464c57b0a1901625b539_u128},
        {Sign::NEG, -144, 0xb82376eeed476f74cc9d1c79d93a9a1e_u128},
        {Sign::NEG, -144, 0xb4aa0d3f79ce94995440d7a131392da8_u128},
        {Sign::NEG, -144, 0xb130a3743b34f90aca0572f7c9f7a7de_u128},
        {Sign::NEG, -144, 0xadb7398d3178e019dfa464cb37fe6455_u128},
        {Sign::NEG, -144, 0xaa3dcf8a5c988d171d26f48efb62e2e0_u128},
        {Sign::NEG, -144, 0xa6c4656bbc924352e0e635a681d259e2_u128},
        {Sign::NEG, -144, 0xa34afb315164461d5f8b022f27cbda35_u128},
        {Sign::NEG, -144, 0x9fd190db1b0cd8c6a40df5ca390a0465_u128},
        {Sign::NEG, -144, 0x9c582669198a3e9e8fb76866f01c4f2d_u128},
        {Sign::NEG, -144, 0x98debbdb4cdabaf4da1f690c752fdeff_u128},
        {Sign::NEG, -144, 0x95655131b4fc9119112db8a3dc07ee78_u128},
        {Sign::NEG, -144, 0x91ebe66c51ee045a9919c4c22125c79e_u128},
        {Sign::NEG, -144, 0x8e727b8b23ad5808ac6aa27226204db3_u128},
        {Sign::NEG, -144, 0x8af9108e2a38cf725bf708fead2b1780_u128},
        {Sign::NEG, -144, 0x877fa575658eade68ee54cbc53cd19ed_u128},
        {Sign::NEG, -144, 0x84063a40d5ad36b402ab59d38cc6e2c5_u128},
        {Sign::NEG, -144, 0x808ccef07a92ad294b0eaf0a99286378_u128},
        {Sign::NEG, -145, 0xfa26c708a87aa929a448b11f012c975c_u128},
        {Sign::NEG, -145, 0xf333eff8c556e089b0a1d584117de73b_u128},
        {Sign::NEG, -145, 0xec4118b14bb6870ee890f9fb57fdabb6_u128},
        {Sign::NEG, -145, 0xe54e41323b962355261d48c71e693130_u128},
        {Sign::NEG, -145, 0xde5b697b94f23bf7efecdd48ed894c32_u128},
        {Sign::NEG, -145, 0xd768918d57c757927944b9957598a88a_u128},
        {Sign::NEG, -145, 0xd075b9678411fcbfa208bc0875093645_u128},
        {Sign::NEG, -145, 0xc982e10a19ceb219f6bb94d89da8b432_u128},
        {Sign::NEG, -145, 0xc290087518f9fe3bb07ebbab782457b0_u128},
        {Sign::NEG, -145, 0xbb9d2fa8819067beb512652945eb9165_u128},
        {Sign::NEG, -145, 0xb4aa56a4538e753c96d57890e171eea5_u128},
        {Sign::NEG, -145, 0xadb77d688ef0ad4e94c5854b9cd01726_u128},
        {Sign::NEG, -145, 0xa6c4a3f533b3968d9a7eb8811ec3e6bb_u128},
        {Sign::NEG, -145, 0x9fd1ca4a41d3b792403bd2ab3e0fa2d7_u128},
        {Sign::NEG, -145, 0x98def067b94d96f4cad61d29db384b6b_u128},
        {Sign::NEG, -145, 0x91ec164d9a1dbb4d2bc55fd6b8a306ec_u128},
        {Sign::NEG, -145, 0x8af93bfbe440ab33011fd6995111a927_u128},
        {Sign::NEG, -145, 0x8406617297b2ed3d959a26faac7e5494_u128},
        {Sign::NEG, -146, 0xfa270d6368e21007c10eab7266ac6bc0_u128},
        {Sign::NEG, -146, 0xec41577274ef04390bb178b90026b2b2_u128},
        {Sign::NEG, -146, 0xde5ba1125385c43bac3bfd925e6b33e1_u128},
        {Sign::NEG, -146, 0xd075ea43049f5d3b9d0a01a95b355319_u128},
        {Sign::NEG, -146, 0xc29033048834dc6431b3b7b20a6a6496_u128},
        {Sign::NEG, -146, 0xb4aa7b56de3f4ee0170da891504620f4_u128},
        {Sign::NEG, -146, 0xa6c4c33a06b7c1d953289e84744549cb_u128},
        {Sign::NEG, -146, 0x98df0aae0197427945519048b0ce7e7f_u128},
        {Sign::NEG, -146, 0x8af951b2ced6dde8a6118c42bf99407e_u128},
        {Sign::NEG, -147, 0xfa273090dcdf429f0e5b474cc5a64cf6_u128},
        {Sign::NEG, -147, 0xde5bbcddc0b533aaa74dab3bd6067bc7_u128},
        {Sign::NEG, -147, 0xc290484c4921a9419f73f4e37357341b_u128},
        {Sign::NEG, -147, 0xa6c4d2dc7616bdb031bf5d5f815220e7_u128},
        {Sign::NEG, -147, 0x8af95c8e47868b414b987ca5fca242d7_u128},
        {Sign::NEG, -148, 0xde5bcac37ac6587d19be3fabd93832c5_u128},
        {Sign::NEG, -148, 0xa6c4daadaf3d75e08fd43f0c9ce444d3_u128},
        {Sign::NEG, -149, 0xde5bd1b658ad4676061cd853e796bc2c_u128},
        {Sign::NEG, -150, 0xde5bd52fc7d8545f87d6afabfba0644f_u128},
        {Sign::POS, 0, 0_u128},
        {Sign::POS, -150, 0xde5bdc22a69d9e19a9bf32001043629d_u128},
        {Sign::POS, -149, 0xde5bdf9c1637d9ef8014f0f360272d82_u128},
        {Sign::POS, -148, 0xa6c4ea5024795bd2fe94a02fc639c0e3_u128},
        {Sign::POS, -148, 0xde5be68ef5db7f99bee710a5ace7c8d4_u128},
        {Sign::POS, -147, 0x8af972453faf11e81a778d8100437e4f_u128},
        {Sign::POS, -147, 0xa6c4f221608e89fe97d773f8992f7051_u128},
        {Sign::POS, -147, 0xc29072dbdd9a0dd50c9ee5841a3afa95_u128},
        {Sign::POS, -147, 0xde5bf474b6df83317b644b13993cf4ef_u128},
        {Sign::POS, -147, 0xfa2776ebec6ccfdb3448f66e2bd7a0ca_u128},
        {Sign::POS, -146, 0x8af97d20bf27eccd6a7ca5f1a87a1a3c_u128},
        {Sign::POS, -146, 0x98df3f3ab64b431d245675fe3061108f_u128},
        {Sign::POS, -146, 0xa6c501c3dba75dc264136e97019d0a3b_u128},
        {Sign::POS, -146, 0xb4aac4bc2f432fa36cdadac4d6925bd4_u128},
        {Sign::POS, -146, 0xc2908823b125aba72899e23791d29632_u128},
        {Sign::POS, -146, 0xd0764bfa6155c4b528039e1f0323a4c1_u128},
        {Sign::POS, -146, 0xde5c10403fda6db5a2912e03afc8cc28_u128},
        {Sign::POS, -146, 0xec41d4f54cba99917681cc9f9e0d89f9_u128},
        {Sign::POS, -146, 0xfa279a1987fd3b3228dae4b7241255e1_u128},
        {Sign::POS, -145, 0x8406afd678d4a2c0f2b412f8dceda28e_u128},
        {Sign::POS, -145, 0x8af992d7c4e2d5b5bf5dccd967504857_u128},
        {Sign::POS, -145, 0x91ec7610a82cafed3716dbf950b07f85_u128},
        {Sign::POS, -145, 0x98df598122b5aadd69eebe0b8e5b18e1_u128},
        {Sign::POS, -145, 0x9fd23d2934813ffcbb583ce65af56beb_u128},
        {Sign::POS, -145, 0xa6c52108dd92e8c1e22978efa7a962a0_u128},
        {Sign::POS, -145, 0xadb805201dee1ea3e89bf3898ef27836_u128},
        {Sign::POS, -145, 0xb4aae96ef5965b1a2c4c997ec90bab0b_u128},
        {Sign::POS, -145, 0xbb9dcdf5648f179c5e3bcd6f21fe6224_u128},
        {Sign::POS, -145, 0xc290b2b36adbcda282cd723bf1524680_u128},
        {Sign::POS, -145, 0xc98397a9087ff6a4f1c8f574935e109b_u128},
        {Sign::POS, -145, 0xd0767cd63d7f0c1c565959c2e4394a59_u128},
        {Sign::POS, -145, 0xd769623b09dc8781af0d4157bc4f05be_u128},
        {Sign::POS, -145, 0xde5c47d76d9be24e4dd6f8576e9188b8_u128},
        {Sign::POS, -145, 0xe54f2dab68c095fbd80c7f46484eee3d_u128},
        {Sign::POS, -145, 0xec4213b6fb4e1c044667957512a6bd26_u128},
        {Sign::POS, -145, 0xf334f9fa2547ede1e505c36d95a074fa_u128},
        {Sign::POS, -145, 0xfa27e074e6b1850f5368655f1ce3110b_u128},
        {Sign::POS, -144, 0x808d63939fc72d83c23a5ac57f06c112_u128},
        {Sign::POS, -144, 0x8406d70897f0f4a2df39eb5890580f93_u128},
        {Sign::POS, -144, 0x87804a995bd7d4a2cd896f3e43f38669_u128},
        {Sign::POS, -144, 0x8af9be45eb7d8a4183b16ff7eecace8c_u128},
        {Sign::POS, -144, 0x8e73320e46e3d23d21ec7ae8ffa1531d_u128},
        {Sign::POS, -144, 0x91eca5f26e0c6953f227268d464ae907_u128},
        {Sign::POS, -144, 0x956619f260f90c44680017af3bbaf2d3_u128},
        {Sign::POS, -144, 0x98df8e0e1fab77cd20c8069e4ae400de_u128},
        {Sign::POS, -144, 0x9c590245aa2568ace381c4651a67ee13_u128},
        {Sign::POS, -144, 0x9fd2769900689ba2a0e23fffd718794e_u128},
        {Sign::POS, -144, 0xa34beb082276cd6d73508b927f485b97_u128},
        {Sign::POS, -144, 0xa6c55f931051bacc9ee5e19f2eecdb55_u128},
        {Sign::POS, -144, 0xaa3ed439c9fb207f916daa3c6c8fdc9d_u128},
        {Sign::POS, -144, 0xadb848fc4f74bb45e265804b77126ed3_u128},
        {Sign::POS, -144, 0xb131bddaa0c047df52fd36ae943fd7b4_u128},
        {Sign::POS, -144, 0xb4ab32d4bddf830bce16dd7f60311bf6_u128},
        {Sign::POS, -144, 0xb824a7eaa6d4298b6846c7451d8105ac_u128},
        {Sign::POS, -144, 0xbb9e1d1c5b9ff81e5fd38e2b0650a884_u128},
        {Sign::POS, -144, 0xbf179269dc44ab851cb619369e1c641f_u128},
        {Sign::POS, -144, 0xc29107d328c400803099a17e0461648c_u128},
        {Sign::POS, -144, 0xc60a7d58411fb3d056dbb75e4813a12b_u128},
        {Sign::POS, -144, 0xc983f2f925598236748c47b1bbe45a07_u128},
        {Sign::POS, -144, 0xccfd68b5d5732873986da1064b5913e1_u128},
        {Sign::POS, -144, 0xd076de8e516e6348faf478d3d0b31300_u128},
        {Sign::POS, -144, 0xd3f05482994cef77fe47f0b26ba754ff_u128},
        {Sign::POS, -144, 0xd769ca92ad1089c22e419b90d8e709b7_u128},
        {Sign::POS, -144, 0xdae340be8cbaeee9406d82eaca788b6f_u128},
        {Sign::POS, -144, 0xde5cb706384ddbaf140a2bff40e0d670_u128},
        {Sign::POS, -144, 0xe1d62d69afcb0cd5b2089d06e51d8034_u128},
        {Sign::POS, -144, 0xe54fa3e8f3343f1f4d0c626a636f2e4f_u128},
        {Sign::POS, -144, 0xe8c91a84028b2f4e416b93f8c6f48d30_u128},
        {Sign::POS, -144, 0xec42913addd19a25152eda1dd615c6f5_u128},
        {Sign::POS, -144, 0xefbc080d85093c66781173186fc07a66_u128},
        {Sign::POS, -144, 0xf3357efbf833d2d543813830e974324d_u128},
        {Sign::POS, -144, 0xf6aef60637531a347a9ea2ef6e1f5d41_u128},
        {Sign::POS, -144, 0xfa286d2c4268cf474a3cd2525dccc623_u128},
        {Sign::POS, -144, 0xfda1e46e1976aed108e19004ae218d5d_u128},
        {Sign::POS, -143, 0x808dade5de3f3aca9b62aaca25d5d18a_u128},
        {Sign::POS, -143, 0x824a69a295c0f02bbee9a8d43e00613c_u128},
        {Sign::POS, -143, 0x8407256d334155edd8d4b69c2056f729_u128},
        {Sign::POS, -143, 0x85c3e145b6c14a72e7cc28605d7bb77e_u128},
        {Sign::POS, -143, 0x87809d2c2041ac1cff51b4bdc834a8f1_u128},
        {Sign::POS, -143, 0x893d59206fc3594e47c0774aa81c3561_u128},
        {Sign::POS, -143, 0x8afa1522a5473068fe4cf331ecb9eb62_u128},
    },
    // -log10(r) for the fourth step, generated by SageMath with:
    //
    // for i in range(-65, 65):
    //   r = 2^-28 * round( 2^28 / (1 + i*2^(-28)) );
    //   s, m, e = RealField(128)(r).log10().sign_mantissa_exponent();
    //   print("{Sign::POS," if (s == -1) else "{Sign::NEG,", e, ",
    //         hex(m), "_u128},");
    /* .step_4 = */
    {
        {Sign::NEG, -151, 0xe1d5464122cf95a4e471a82bbedbe0ae_u128},
        {Sign::NEG, -151, 0xde5bd6ec7f7bc110af6e93be8e4c1764_u128},
        {Sign::NEG, -151, 0xdae26797a490f80ee44848f0a5779499_u128},
        {Sign::NEG, -151, 0xd768f842920f3a9890205533f4e70566_u128},
        {Sign::NEG, -151, 0xd3ef88ed47f688a6c01844ace3729e48_u128},
        {Sign::NEG, -151, 0xd0761997c646e2328151a2324e41c7c4_u128},
        {Sign::NEG, -151, 0xccfcaa420d004734e0edf74d88cacafd_u128},
        {Sign::NEG, -151, 0xc9833aec1c22b7a6ec0ecc3a5cd27e58_u128},
        {Sign::NEG, -151, 0xc609cb95f3ae3381afd5a7e70a6bf214_u128},
        {Sign::NEG, -151, 0xc2905c3f93a2babe39640ff447f81ceb_u128},
        {Sign::NEG, -151, 0xbf16ece8fc004d5595db88b5422588b1_u128},
        {Sign::NEG, -151, 0xbb9d7d922cc6eb40d25d952f9beffeec_u128},
        {Sign::NEG, -151, 0xb8240e3b25f69478fc0bb71b6ea03578_u128},
        {Sign::NEG, -151, 0xb4aa9ee3e78f48f720076ee349cb7b20_u128},
        {Sign::NEG, -151, 0xb1312f8c719108b44b723ba43353643d_u128},
        {Sign::NEG, -151, 0xadb7c034c3fbd3a98b6d9b2da7657754_u128},
        {Sign::NEG, -151, 0xaa3e50dcdecfa9cfed1b0a01987ad9b4_u128},
        {Sign::NEG, -151, 0xa6c4e184c20c8b207d9c03546f57fc11_u128},
        {Sign::NEG, -151, 0xa34b722c6db277944a12010d0b0c4727_u128},
        {Sign::NEG, -151, 0x9fd202d3e1c16f245f9e7bc4c0f1c851_u128},
        {Sign::NEG, -151, 0x9c58937b1e3971c9cb62eac75cacde29_u128},
        {Sign::NEG, -151, 0x98df2422231a7f7d9a80c413202be52a_u128},
        {Sign::NEG, -151, 0x9565b4c8f0649838da197c58c3a6e445_u128},
        {Sign::NEG, -151, 0x91ec456f8617bbf4974e86fb759f3988_u128},
        {Sign::NEG, -151, 0x8e72d615e433eaa9df415610dadf46b3_u128},
        {Sign::NEG, -151, 0x8af966bc0ab92451bf135a610e7a1ddc_u128},
        {Sign::NEG, -151, 0x877ff761f9a768e543e60366a1cb2e09_u128},
        {Sign::NEG, -151, 0x84068807b0feb85d7adabf4e9c75efce_u128},
        {Sign::NEG, -151, 0x808d18ad30bf12b37112faf87c6591ee_u128},
        {Sign::NEG, -152, 0xfa2752a4f1d0efc0676043ec6b994be5_u128},
        {Sign::NEG, -152, 0xf33473ef12f5cfb99fa73d186649999d_u128},
        {Sign::NEG, -152, 0xec419538c4ecc544a53db362aa5cc6f0_u128},
        {Sign::NEG, -152, 0xe54eb68207b5d0539266761de5e05f13_u128},
        {Sign::NEG, -152, 0xde5bd7cadb50f0d881645201b36e17ba_u128},
        {Sign::NEG, -152, 0xd768f9133fbe26c58c7a112a9a2b2a52_u128},
        {Sign::NEG, -152, 0xd0761a5b34fd720ccdea7b1a0dc7ad42_u128},
        {Sign::NEG, -152, 0xc9833ba2bb0ed2a05ff854b66e7ded1f_u128},
        {Sign::NEG, -152, 0xc2905ce9d1f248725ce6604b0911c5ed_u128},
        {Sign::NEG, -152, 0xbb9d7e3079a7d374def75d8816cffc59_u128},
        {Sign::NEG, -152, 0xb4aa9f76b22f739a006e0982bd8d96ef_u128},
        {Sign::NEG, -152, 0xadb7c0bc7b8928d3db8d1eb50fa7375c_u128},
        {Sign::NEG, -152, 0xa6c4e201d5b4f3148a9754fe0c0073a7_u128},
        {Sign::NEG, -152, 0x9fd20346c0b2d24e27cf61a19e032f69_u128},
        {Sign::NEG, -152, 0x98df248b3c82c672cd77f7489d9ef50b_u128},
        {Sign::NEG, -152, 0x91ec45cf4924cf7495d3c600cf484f03_u128},
        {Sign::NEG, -152, 0x8af96712e698ed459b257b3ce3f82109_u128},
        {Sign::NEG, -152, 0x8406885614df1fd7f7afc1d4792b015a_u128},
        {Sign::NEG, -153, 0xfa275331a7eece3b8b6a840831c123d8_u128},
        {Sign::NEG, -153, 0xec4195b647c386123ef142da7335b35a_u128},
        {Sign::NEG, -153, 0xde5bd83a093c67183e79062c7cbb3b7d_u128},
        {Sign::NEG, -153, 0xd0761abcec597131be870ed4ed5b755b_u128},
        {Sign::NEG, -153, 0xc2905d3ef11aa442f3a098743d20fb64_u128},
        {Sign::NEG, -153, 0xb4aa9fc017800030124ad974bd15fbca_u128},
        {Sign::NEG, -153, 0xa6c4e2405f8984dd4f0b030a9742eb00_u128},
        {Sign::NEG, -153, 0x98df24bfc937322ede664133cead362d_u128},
        {Sign::NEG, -153, 0x8af9673e54890808f4e1bab83f55f5a1_u128},
        {Sign::NEG, -154, 0xfa27537802fe0c9f8e0522533c713e98_u128},
        {Sign::NEG, -154, 0xde5bd871a03259cf129bc1c6f293726e_u128},
        {Sign::NEG, -154, 0xc2905d6980aef768e09182166eeb17eb_u128},
        {Sign::NEG, -154, 0xa6c4e25fa473e53560f08720313daa3f_u128},
        {Sign::NEG, -154, 0x8af967540b8122fcfcc2ea566b3af38b_u128},
        {Sign::NEG, -155, 0xde5bd88d6bad61103a25757e00f4e3a0_u128},
        {Sign::NEG, -155, 0xa6c4e26f46e91b3e55d3f9e70cf177b8_u128},
        {Sign::NEG, -156, 0xde5bd89b516ae82a3d4aac85125398d0_u128},
        {Sign::NEG, -157, 0xde5bd8a24449ac959ab5a849a06f400d_u128},
        {Sign::POS, 0, 0_u128},
        {Sign::POS, -157, 0xde5bd8b02a0737290d3cc88fd4ef34c2_u128},
        {Sign::POS, -156, 0xde5bd8b71ce5fd51225916c2b3f33c90_u128},
        {Sign::POS, -155, 0xa6c4e28e8bd3930a17847f98acf08d54_u128},
        {Sign::POS, -155, 0xde5bd8c502a38b5e044397830931fddd_u128},
        {Sign::POS, -154, 0x8af9677f79717409c2ab385913176984_u128},
        {Sign::POS, -154, 0xa6c4e29e2e48d4cce454dec82bde52e5_u128},
        {Sign::POS, -154, 0xc2905dbe9fd7e82ffe1522b0470d7d7f_u128},
        {Sign::POS, -154, 0xde5bd8e0ce1eae6aa6e2721f2afc3cce_u128},
        {Sign::POS, -154, 0xfa275404b91d27b475b3458eec3c106c_u128},
        {Sign::POS, -153, 0x8af967953069aa2280bf0ff2f6cd9f93_u128},
        {Sign::POS, -153, 0x98df2528e2a09a29f09cc73b7013b906_u128},
        {Sign::POS, -153, 0xa6c4e2bd7333640c55ee1480619827c4_u128},
        {Sign::POS, -153, 0xb4aaa052e22207e57c2e48d772250b3c_u128},
        {Sign::POS, -153, 0xc2905de92f6c85d12ed8ba8c6fa81c98_u128},
        {Sign::POS, -153, 0xd0761b805b12ddeb3968c5214f33fc4f_u128},
        {Sign::POS, -153, 0xde5bd9186515104f6759c94e2d017fad_u128},
        {Sign::POS, -153, 0xec4196b14d731d1984272d014c70fe58_u128},
        {Sign::POS, -153, 0xfa27544b142d04655b4c5b5f180b9fe1_u128},
        {Sign::POS, -152, 0x840688f2dca163275c22626110c254a4_u128},
        {Sign::POS, -152, 0x8af967c09e5a3178b345ef5d90dd6545_u128},
        {Sign::POS, -152, 0x91ec468ecf40ed3498ce92087c5cb614_u128},
        {Sign::POS, -152, 0x98df255d6f559668f27a0a6056dcfe57_u128},
        {Sign::POS, -152, 0x9fd2042c7e982d23a6061afeb7929f24_u128},
        {Sign::POS, -152, 0xa6c4e2fbfd08b17299308918494a4a20_u128},
        {Sign::POS, -152, 0xadb7c1cbeaa72363b1b71c7cca69a844_u128},
        {Sign::POS, -152, 0xb4aaa09c47738304d5579f970cf000a9_u128},
        {Sign::POS, -152, 0xbb9d7f6d136dd063e9cfdf6cf676df42_u128},
        {Sign::POS, -152, 0xc2905e3e4e960b8ed4ddab9f8032bbab_u128},
        {Sign::POS, -152, 0xc9833d0ff8ec34937c3ed66ab6f39fe9_u128},
        {Sign::POS, -152, 0xd0761be212704b7fc5b134a5bb25cf2e_u128},
        {Sign::POS, -152, 0xd768fab49b22506196f29dc2c0d26ca0_u128},
        {Sign::POS, -152, 0xde5bd98793024346d5c0ebcf0fa0221e_u128},
        {Sign::POS, -152, 0xe54eb85afa10243d67d9fb7302d3c705_u128},
        {Sign::POS, -152, 0xec41972ed04bf35332fbabf2095106f1_u128},
        {Sign::POS, -152, 0xf334760315b5b0961ce3df2aa59b0889_u128},
        {Sign::POS, -152, 0xfa2754d7ca4d5c140b5079966dd5143e_u128},
        {Sign::POS, -151, 0x808d19d677097aed71ffb12505e19d89_u128},
        {Sign::POS, -151, 0x8406894140833efc4657417a9e657eae_u128},
        {Sign::POS, -151, 0x877ff8ac4193fa3d758de3f168f9f8c9_u128},
        {Sign::POS, -151, 0x8af968177a3bacb7f2828ffc57f43581_u128},
        {Sign::POS, -151, 0x8e72d782ea7a5672b0143e5be77b1053_u128},
        {Sign::POS, -151, 0x91ec46ee924ff774a121e91e1d8769ef_u128},
        {Sign::POS, -151, 0x9565b65a71bc8fc4b88a8b9e89e47b9c_u128},
        {Sign::POS, -151, 0x98df25c688c01f69e92d228646302a9c_u128},
        {Sign::POS, -151, 0x9c589532d75aa66b25e8abcbf5db5b8c_u128},
        {Sign::POS, -151, 0x9fd2049f5d8c24cf619c26b3c62a45c8_u128},
        {Sign::POS, -151, 0xa34b740c1b549a9d8f2693cf6e34c6cc_u128},
        {Sign::POS, -151, 0xa6c4e37910b407dca166f4fe2ee6b59a_u128},
        {Sign::POS, -151, 0xaa3e52e63daa6c938b3c4d6cd3003616_u128},
        {Sign::POS, -151, 0xadb7c253a237c8c93f85a195af160c71_u128},
        {Sign::POS, -151, 0xb13131c13e5c1c84b121f740a191f084_u128},
        {Sign::POS, -151, 0xb4aaa12f121767ccd2f0558312b2e136_u128},
        {Sign::POS, -151, 0xb824109d1d69aaa897cfc4bff48d77de_u128},
        {Sign::POS, -151, 0xbb9d800b6052e51ef29f4ea7c30c3ba5_u128},
        {Sign::POS, -151, 0xbf16ef79dad31736d63dfe3883eff4e9_u128},
        {Sign::POS, -151, 0xc2905ee88cea40f7358adfbdc6d0009f_u128},
        {Sign::POS, -151, 0xc609ce5776986267036500d0a51aa3b6_u128},
        {Sign::POS, -151, 0xc9833dc697dd7b8d32ab7057c2155e78_u128},
        {Sign::POS, -151, 0xccfcad35f0b98c70b63d3e874add3ff0_u128},
        {Sign::POS, -151, 0xd0761ca5812c951880f97ce0f6673948_u128},
        {Sign::POS, -151, 0xd3ef8c154936958b85bf3e340580712d_u128},
        {Sign::POS, -151, 0xd768fb8548d78dd0b76d969d42ce9734_u128},
        {Sign::POS, -151, 0xdae26af5800f7def08e39b8702d0373a_u128},
        {Sign::POS, -151, 0xde5bda65eede65ed6d0063a923dd0cc6_u128},
    }};

// > P = fpminimax(log10(1 + x)/x, 3, [|128...|], [-0x1.0002143p-29 , 0x1p-29]);
// > P;
// > dirtyinfnorm(log10(1 + x)/x - P, [-0x1.0002143p-29 , 0x1p-29]);
// 0x1.64fb8...p-123
const Float128 BIG_COEFFS[4]{
    {Sign::NEG, -131, 0xde5bd8a9373f89a76903c4ce1582517d_u128},
    {Sign::POS, -130, 0x943d3b1b7a1af679b8a21791624e2e8a_u128},
    {Sign::NEG, -130, 0xde5bd8a937287195355baaafabc25990_u128},
    {Sign::POS, -129, 0xde5bd8a937287195355baaafad33dbd9_u128},
};

// Reuse the output of the fast pass range reduction.
// -2^-8 <= m_x < 2^-7
double log10_accurate(int e_x, int index, double m_x) {

  Float128 e_x_f128(static_cast<float>(e_x));
  Float128 sum = fputil::quick_mul(LOG10_2, e_x_f128);
  sum = fputil::quick_add(sum, LOG10_TABLE.step_1[index]);

  Float128 v_f128 = log_range_reduction(m_x, LOG10_TABLE, sum);

  // Polynomial approximation
  Float128 p = fputil::quick_mul(v_f128, BIG_COEFFS[0]);
  p = fputil::quick_mul(v_f128, fputil::quick_add(p, BIG_COEFFS[1]));
  p = fputil::quick_mul(v_f128, fputil::quick_add(p, BIG_COEFFS[2]));
  p = fputil::quick_mul(v_f128, fputil::quick_add(p, BIG_COEFFS[3]));

  Float128 r = fputil::quick_add(sum, p);

  return static_cast<double>(r);
}

} // namespace

LLVM_LIBC_FUNCTION(double, log10, (double x)) {
  using FPBits_t = typename fputil::FPBits<double>;
  using Sign = fputil::Sign;
  FPBits_t xbits(x);
  uint64_t x_u = xbits.uintval();

  int x_e = -FPBits_t::EXP_BIAS;

  if (LIBC_UNLIKELY(xbits == FPBits_t::one())) {
    // log10(1.0) = +0.0
    return 0.0;
  }

  if (LIBC_UNLIKELY(xbits.uintval() < FPBits_t::min_normal().uintval() ||
                    xbits.uintval() > FPBits_t::max_normal().uintval())) {
    if (xbits.is_zero()) {
      // return -Inf and raise FE_DIVBYZERO.
      fputil::set_errno_if_required(ERANGE);
      fputil::raise_except_if_required(FE_DIVBYZERO);
      return FPBits_t::inf(Sign::NEG).get_val();
    }
    if (xbits.is_neg() && !xbits.is_nan()) {
      fputil::set_errno_if_required(EDOM);
      fputil::raise_except_if_required(FE_INVALID);
      return FPBits_t::quiet_nan().get_val();
    }
    if (xbits.is_inf_or_nan()) {
      return x;
    }
    // Normalize denormal inputs.
    xbits = FPBits_t(x * 0x1.0p52);
    x_e -= 52;
    x_u = xbits.uintval();
  }

  // log10(x) = log10(2^x_e * x_m)
  //          = x_e * log10(2) + log10(x_m)

  // Range reduction for log10(x_m):
  // For each x_m, we would like to find r such that:
  //   -2^-8 <= r * x_m - 1 < 2^-7
  int shifted = static_cast<int>(x_u >> 45);
  int index = shifted & 0x7F;
  double r = RD[index];

  // Add unbiased exponent. Add an extra 1 if the 8 leading fractional bits are
  // all 1's.
  x_e += static_cast<int>((x_u + (1ULL << 45)) >> 52);
  double e_x = static_cast<double>(x_e);

  // hi is exact
  double hi = fputil::multiply_add(e_x, LOG_2_HI, LOG_R_DD[index].hi);
  // lo errors ~ e_x * LSB(LOG_2_LO) + LSB(LOG_R[index].lo) + rounding err
  //           <= 2 * (e_x * LSB(LOG_2_LO) + LSB(LOG_R[index].lo))
  double lo = fputil::multiply_add(e_x, LOG_2_LO, LOG_R_DD[index].lo);

  // Set m = 1.mantissa.
  uint64_t x_m = (x_u & 0x000F'FFFF'FFFF'FFFFULL) | 0x3FF0'0000'0000'0000ULL;
  double m = FPBits_t(x_m).get_val();

  double u, u_sq, err;
  fputil::DoubleDouble r1;

  // Perform exact range reduction
#ifdef LIBC_TARGET_CPU_HAS_FMA
  u = fputil::multiply_add(r, m, -1.0); // exact
#else
  uint64_t c_m = x_m & 0x3FFF'E000'0000'0000ULL;
  double c = FPBits_t(c_m).get_val();
  u = fputil::multiply_add(r, m - c, CD[index]); // exact
#endif // LIBC_TARGET_CPU_HAS_FMA

  // Error of u_sq = ulp(u^2);
  u_sq = u * u;
  // Degree-7 minimax polynomial
  double p0 = fputil::multiply_add(u, LOG_COEFFS[1], LOG_COEFFS[0]);
  double p1 = fputil::multiply_add(u, LOG_COEFFS[3], LOG_COEFFS[2]);
  double p2 = fputil::multiply_add(u, LOG_COEFFS[5], LOG_COEFFS[4]);
  double p = fputil::polyeval(u_sq, lo, p0, p1, p2);

  // Exact sum:
  //   r1.hi + r1.lo = e_x * log(2)_hi - log(r)_hi + u
  r1 = fputil::exact_add(hi, u);
  r1.lo += p;

  // Quick double-double multiplication:
  //   r2.hi + r2.lo ~ r1 * log10(e),
  // with error bounded by:
  //   4*ulp( ulp(r2.hi) )
  fputil::DoubleDouble r2 = fputil::quick_mult(r1, LOG10_E);

  // Technicallly error of r1.lo is bounded by:
  //    |hi|*ulp(log(2)_lo) + C*ulp(u^2)
  // To simplify the error computation a bit, we replace |hi|*ulp(log(2)_lo)
  // with the upper bound: 2^11 * ulp(log(2)_lo) = 2^-85.
  // Total error is bounded by ~ C * ulp(u^2) + 2^-85.
  err = fputil::multiply_add(u_sq, P_ERR, HI_ERR);

  // Lower bound from the result
  double left = r2.hi + (r2.lo - err);
  // Upper bound from the result
  double right = r2.hi + (r2.lo + err);

  // Ziv's test if fast pass is accurate enough.
  if (left == right)
    return left;

  // Exact cases:
  if (LIBC_UNLIKELY((x_u & 0x3FFFFF) == 0)) {
    switch (x_u) {
    case 0x4024000000000000: // x = 10.0
      return 1.0;
    case 0x4059000000000000: // x = 10^2
      return 2.0;
    case 0x408f400000000000: // x = 10^3
      return 3.0;
    case 0x40c3880000000000: // x = 10^4
      return 4.0;
    case 0x40f86a0000000000: // x = 10^5
      return 5.0;
    case 0x412e848000000000: // x = 10^6
      return 6.0;
    case 0x416312d000000000: // x = 10^7
      return 7.0;
    case 0x4197d78400000000: // x = 10^8
      return 8.0;
    case 0x41cdcd6500000000: // x = 10^9
      return 9.0;
    case 0x4202a05f20000000: // x = 10^10
      return 10.0;
    case 0x42374876e8000000: // x = 10^11
      return 11.0;
    case 0x426d1a94a2000000: // x = 10^12
      return 12.0;
    case 0x42a2309ce5400000: // x = 10^13
      return 13.0;
    }
  } else {
    switch (x_u) {
    case 0x42d6bcc41e900000: // x = 10^14
      return 14.0;
    case 0x430c6bf526340000: // x = 10^15
      return 15.0;
    case 0x4341c37937e08000: // x = 10^16
      return 16.0;
    case 0x4376345785d8a000: // x = 10^17
      return 17.0;
    case 0x43abc16d674ec800: // x = 10^18
      return 18.0;
    case 0x43e158e460913d00: // x = 10^19
      return 19.0;
    case 0x4415af1d78b58c40: // x = 10^20
      return 20.0;
    case 0x444b1ae4d6e2ef50: // x = 10^21
      return 21.0;
    case 0x4480f0cf064dd592: // x = 10^22
      return 22.0;
    }
  }

  return log10_accurate(x_e, index, u);
}

} // namespace LIBC_NAMESPACE
