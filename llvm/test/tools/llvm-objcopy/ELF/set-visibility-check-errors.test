
# RUN: yaml2obj %s -o %t.o
# RUN: echo 'foo' > %t.symbols

# Check if passing an invalid visibility type generates an error message
# RUN: not llvm-objcopy %t.o --set-visibility-syms=%t.symbols=invalid-type --regex 2>&1 | FileCheck %s --check-prefix=TYPE
# RUN: not llvm-objcopy %t.o --set-visibility-sym=foo=invalid-type --regex 2>&1 | FileCheck %s --check-prefix=TYPE
# TYPE: error: 'invalid-type' is not a valid symbol visibility

# Check if using the option multiple times generates an error message
# RUN: not llvm-objcopy %t.o --set-visibility-syms=%t.symbols=hidden \
# RUN:                       --set-visibility-syms=%t.symbols=default \
# RUN:                       --regex 2>&1 | FileCheck %s --check-prefix=MULTIPLE
# RUN: not llvm-objcopy %t.o --set-visibility-sym=foo=hidden \
# RUN:                       --set-visibility-sym=bar=default \
# RUN:                       --regex 2>&1 | FileCheck %s --check-prefix=MULTIPLE
# RUN: not llvm-objcopy %t.o --set-visibility-syms=%t.symbols=hidden \
# RUN:                       --set-visibility-sym=bar=default \
# RUN:                       --regex 2>&1 | FileCheck %s --check-prefix=MULTIPLE
# MULTIPLE: error: multiple specifications of visibility type

# Check if not using the proper format with character '=' generates an error
# RUN: not llvm-objcopy %t.o --set-visibility-syms=%t.symbols,hidden 2>&1 | FileCheck %s --check-prefix=FORMAT
# RUN: not llvm-objcopy %t.o --set-visibility-sym=foo default 2>&1 | FileCheck %s --check-prefix=FORMAT
# FORMAT: error: bad format for --set-visibility-sym

# Check if using an invalid symbol pattern generates an error
# RUN: echo '*.' > %t.symbols.regex
# RUN: not llvm-objcopy %t.o --set-visibility-syms=%t.symbols.regex=hidden --regex 2>&1 | FileCheck %s --check-prefix=SYMBOL
# RUN: not llvm-objcopy %t.o --set-visibility-sym=*.=default --regex 2>&1 | FileCheck %s --check-prefix=SYMBOL
# SYMBOL: error: cannot compile regular expression '*.': repetition-operator operand invalid

# Check passing an invalid filename generates an error
# RUN: not llvm-objcopy %t.o --set-visibility-syms=no_file=hidden 2>&1 | FileCheck %s --check-prefix=FILE
# FILE: error: 'no_file': No such file or directory


!ELF
FileHeader:
  Class:           ELFCLASS64
  Data:            ELFDATA2LSB
  Type:            ET_REL
  Machine:         EM_X86_64
