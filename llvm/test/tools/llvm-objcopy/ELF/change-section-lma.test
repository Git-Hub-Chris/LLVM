# RUN: yaml2obj %s -o %t
# RUN: llvm-objcopy --change-section-lma *+0x20 %t %t2
# RUN: llvm-readelf -l %t2 | FileCheck %s --check-prefix=CHECK-PLUS
# RUN: llvm-objcopy --change-section-lma *-0x10 %t2 %t3
# RUN: llvm-readelf -l %t3 | FileCheck %s --check-prefix=CHECK-MINUS
# RUN: not llvm-objcopy --change-section-lma .text3=0x5000 %t  2>&1 | FileCheck %s --check-prefix=ERR-SET-ADDRESS
# RUN: not llvm-objcopy --change-section-lma .text3+0x30 %t  2>&1 | FileCheck %s --check-prefix=ERR-SPECIFIC-SEC
# RUN: not llvm-objcopy --change-section-lma *+0c50 %t  2>&1 | FileCheck %s --check-prefix=ERR-INVALID-VAL
# RUN: not llvm-objcopy --change-section-lma 0 %t  2>&1 | FileCheck %s --check-prefix=ERR-MISSING-OFFSET

# CHECK-PLUS:  Type           Offset   VirtAddr           PhysAddr           FileSiz  MemSiz
# CHECK-PLUS:  PHDR           0x000002 0x0000000000001002 0x0000000000001022 0x000038 0x000000
# CHECK-PLUS:  LOAD           0x000000 0x0000000000001000 0x0000000000001020 0x001120 0x001120
# CHECK-PLUS:  LOAD           0x001120 0x0000000000005000 0x0000000000006020 0x001000 0x001000
# CHECK-PLUS:  NOTE           0x000000 0x0000000000000000 0x0000000000000000 0x000000 0x000000

# CHECK-MINUS:  PHDR           0x000002 0x0000000000001002 0x0000000000001012 0x000038 0x000000
# CHECK-MINUS:  LOAD           0x000000 0x0000000000001000 0x0000000000001010 0x001120 0x001120
# CHECK-MINUS:  LOAD           0x001120 0x0000000000005000 0x0000000000006010 0x001000 0x001000
# CHECK-MINUS:  NOTE           0x000000 0x0000000000000000 0x0000000000000000 0x000000 0x000000

# ERR-SET-ADDRESS: error: bad format for --change-section-lma: changing LMA to a specific value is not supported. Use *+val or *-val instead
# ERR-SPECIFIC-SEC: error: bad format for --change-section-lma: changing a specific section LMA is not supported. Use *+val or *-val instead
# ERR-INVALID-VAL: error: bad format for --change-section-lma: value after *+ is 0c50 when it should be integer
# ERR-MISSING-OFFSET: error: bad format for --change-section-lma: missing LMA offset

!ELF
FileHeader:
  Class:           ELFCLASS64
  Data:            ELFDATA2LSB
  Type:            ET_EXEC
Sections:
  - Name:          .text1
    Type:          SHT_PROGBITS
    Size:          0x1000
  - Name:          .text2
    Type:          SHT_PROGBITS
    Size:          0x1000
ProgramHeaders:
  - Type:          PT_PHDR
    FileSize:      0x38
    Offset:        0x2
    VAddr:         0x1002
  - Type:          PT_LOAD
    Offset:        0x0
    VAddr:         0x1000
    FirstSec:      .text1
    LastSec:       .text1
  - Type:          PT_LOAD
    VAddr:         0x5000
    PAddr:         0x6000
    FirstSec:      .text2
    LastSec:       .text2
  - Type:          PT_NOTE
    FileSize:      0x0
