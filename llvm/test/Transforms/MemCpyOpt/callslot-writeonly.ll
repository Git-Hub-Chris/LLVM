; NOTE: Assertions have been autogenerated by utils/update_test_checks.py UTC_ARGS: --version 5
; RUN: opt -S -passes=memcpyopt < %s | FileCheck %s

; Check that we clear writeonly from the parameter when performing call slot optimization.

define void @writeonly_param(ptr noalias writable writeonly dereferenceable(8) %dst) {
; CHECK-LABEL: define void @writeonly_param(
; CHECK-SAME: ptr noalias writable dereferenceable(8) [[DST:%.*]]) {
; CHECK-NEXT:    [[SRC:%.*]] = alloca i64, align 8
; CHECK-NEXT:    call void @accept_ptr(ptr nocapture [[DST]]) #[[ATTR1:[0-9]+]]
; CHECK-NEXT:    ret void
;
  %src = alloca i64, align 8
  call void @accept_ptr(ptr nocapture %src) nounwind
  call void @llvm.memcpy.p0.p0.i64(ptr align 8 %dst, ptr %src, i64 8, i1 false)
  ret void
}

declare void @accept_ptr(ptr)
