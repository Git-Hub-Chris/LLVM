; NOTE: Assertions have been autogenerated by utils/update_test_checks.py UTC_ARGS: --version 4
; RUN: opt < %s -passes=float2int -S | FileCheck %s -check-prefixes=CHECK,NONE
; RUN: opt < %s -passes=float2int -S --data-layout="n64" | FileCheck %s -check-prefixes=CHECK,ONLY64
; RUN: opt < %s -passes=float2int -S --data-layout="n8:16:32:64"| FileCheck %s -check-prefixes=CHECK,MULTIPLE
; RUN: opt < %s -passes=float2int -S --data-layout="e-m:o-p270:32:32-p271:32:32-p272:64:64-i64:64-i128:128-f80:128-n8:16:32:64-S128"| FileCheck %s -check-prefixes=CHECK,PR-79158

define i32 @pr79158(i32 %x) {
; CHECK-LABEL: define i32 @pr79158(
; CHECK-SAME: i32 [[X:%.*]]) {
; CHECK-NEXT:  entry:
; CHECK-NEXT:    [[CMP:%.*]] = icmp sgt i32 [[X]], 0
; CHECK-NEXT:    [[TMP0:%.*]] = zext i1 [[CMP]] to i64
; CHECK-NEXT:    [[MUL1:%.*]] = mul i64 [[TMP0]], 4294967295
; CHECK-NEXT:    [[TMP1:%.*]] = trunc i64 [[MUL1]] to i32
; CHECK-NEXT:    ret i32 [[TMP1]]
;
entry:
  %cmp = icmp sgt i32 %x, 0
  %conv = uitofp i1 %cmp to double
  %mul = fmul double %conv, 0x41EFFFFFFFE00000
  %conv1 = fptoui double %mul to i32
  ret i32 %conv1
}

define i32 @pr79158_2(i32 %x) {
; CHECK-LABEL: define i32 @pr79158_2(
; CHECK-SAME: i32 [[X:%.*]]) {
; CHECK-NEXT:  entry:
; CHECK-NEXT:    [[CMP:%.*]] = icmp sgt i32 [[X]], 0
; CHECK-NEXT:    [[TMP0:%.*]] = zext i1 [[CMP]] to i32
; CHECK-NEXT:    [[MUL1:%.*]] = mul i32 [[TMP0]], 255
; CHECK-NEXT:    [[TMP1:%.*]] = trunc i32 [[MUL1]] to i8
; CHECK-NEXT:    [[CONV2:%.*]] = zext i8 [[TMP1]] to i32
; CHECK-NEXT:    ret i32 [[CONV2]]
;
entry:
  %cmp = icmp sgt i32 %x, 0
  %conv = uitofp i1 %cmp to float
  %mul = fmul float %conv, 2.550000e+02
  %conv1 = fptoui float %mul to i8
  %conv2 = zext i8 %conv1 to i32
  ret i32 %conv2
}
;; NOTE: These prefixes are unused and the list is autogenerated. Do not add tests below this line:
; MULTIPLE: {{.*}}
; NONE: {{.*}}
; ONLY64: {{.*}}
; PR-79158: {{.*}}
