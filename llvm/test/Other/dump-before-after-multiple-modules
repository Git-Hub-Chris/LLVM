; RUN: mkdir -p %t/logs
; RUN: rm -rf %t/logs

; RUN: split-file %s %t
; RUN: opt %t/module-foo -disable-output -passes='no-op-module,function(no-op-function),function(loop(no-op-loop)),no-op-module' -ir-dump-directory %t/logs -dump-after=no-op-module,no-op-function,no-op-loop -dump-before=no-op-module,no-op-function,no-op-loop
; RUN: opt %t/module-bar -disable-output -passes='no-op-module,function(no-op-function),function(loop(no-op-loop)),no-op-module' -ir-dump-directory %t/logs -dump-after=no-op-module,no-op-function,no-op-loop -dump-before=no-op-module,no-op-function,no-op-loop
; RUN: find %t/logs -type f -print | FileCheck %s
; CHECK-DAG: module-foo/0.NoOpModulePass.0-before.ll
; CHECK-DAG: module-foo/0.NoOpModulePass.0-after.ll
; CHECK-DAG: module-foo/1.ModuleToFunctionPassAdaptor.0/0.PassManager<llvm::Function>.0/0.NoOpFunctionPass.0-before.ll
; CHECK-DAG: module-foo/1.ModuleToFunctionPassAdaptor.0/0.PassManager<llvm::Function>.0/0.NoOpFunctionPass.0-after.ll
; CHECK-DAG: module-foo/3.NoOpModulePass.1-before.ll
; CHECK-DAG: module-foo/3.NoOpModulePass.1-after.ll
; CHECK-DAG: module-bar/0.NoOpModulePass.0-before.ll
; CHECK-DAG: module-bar/0.NoOpModulePass.0-after.ll
; CHECK-DAG: module-bar/1.ModuleToFunctionPassAdaptor.0/0.PassManager<llvm::Function>.0/0.NoOpFunctionPass.0-before.ll
; CHECK-DAG: module-bar/1.ModuleToFunctionPassAdaptor.0/0.PassManager<llvm::Function>.0/0.NoOpFunctionPass.0-after.ll
; CHECK-DAG: module-bar/2.ModuleToFunctionPassAdaptor.1/0.PassManager<llvm::Function>.0/0.FunctionToLoopPassAdaptor.0/1.PassManager<llvm::Loop, llvm::AnalysisManager<llvm::Loop, llvm::LoopStandardAnalysisResults&>, llvm::LoopStandardAnalysisResults&, llvm::LPMUpdater&>.0/0.NoOpLoopPass.0-before.ll
; CHECK-DAG: module-bar/2.ModuleToFunctionPassAdaptor.1/0.PassManager<llvm::Function>.0/0.FunctionToLoopPassAdaptor.0/1.PassManager<llvm::Loop, llvm::AnalysisManager<llvm::Loop, llvm::LoopStandardAnalysisResults&>, llvm::LoopStandardAnalysisResults&, llvm::LPMUpdater&>.0/0.NoOpLoopPass.0-after.ll
; CHECK-DAG: module-bar/3.NoOpModulePass.1-before.ll
; CHECK-DAG: module-bar/3.NoOpModulePass.1-after.ll

;--- module-foo

define void @foo() {
    ret void
}

;--- module-bar

define void @bar() {
entry:
    br label %loop
loop:
    br label %loop
}
