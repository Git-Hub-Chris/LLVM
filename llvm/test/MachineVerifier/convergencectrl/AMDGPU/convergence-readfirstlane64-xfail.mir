# RUN: not --crash llc -mtriple=amdgcn -run-pass=none -verify-machineinstrs -o /dev/null %s 2>&1 | FileCheck %s
---
name:            basic_branch_i64
tracksRegLiveness: true
body:             |
  bb.0:
    successors: %bb.1, %bb.2
    liveins: $vgpr0, $vgpr1, $vgpr2

    %7:vgpr_32 = COPY $vgpr2
    %6:vgpr_32 = COPY $vgpr1
    %5:vgpr_32 = COPY $vgpr0
    %8:sreg_64 = REG_SEQUENCE %5, %subreg.sub0, %6, %subreg.sub1
    %9:vgpr_32 = V_AND_B32_e64 1, %7, implicit $exec
    %10:sreg_64 = V_CMP_EQ_U32_e64 killed %9, 1, implicit $exec
    %0:sreg_64 = CONVERGENCECTRL_ANCHOR
    %11:sreg_64 = S_MOV_B64 1
    %1:vreg_64 = V_ADD_U64_PSEUDO killed %8, killed %11, implicit-def dead $vcc, implicit $exec
    %2:sreg_64 = SI_IF killed %10, %bb.2, implicit-def dead $exec, implicit-def dead $scc, implicit $exec
    S_BRANCH %bb.1

  bb.1:
    successors: %bb.2

    %12:vgpr_32 = COPY %1.sub1
    ; CHECK: Cannot mix controlled and uncontrolled convergence in the same function.
    ; CHECK: V_READFIRSTLANE_B32 killed %{{[0-9]+}}:vgpr_32, implicit $exec
    %13:sreg_32 = V_READFIRSTLANE_B32 killed %12, implicit $exec
    %14:vgpr_32 = COPY %1.sub0
    ; CHECK: Cannot mix controlled and uncontrolled convergence in the same function.
    ; CHECK: V_READFIRSTLANE_B32 killed %{{[0-9]+}}:vgpr_32, implicit $exec
    %15:sreg_32 = V_READFIRSTLANE_B32 killed %14, implicit $exec
    %16:sreg_64 = REG_SEQUENCE killed %15, %subreg.sub0, killed %13, %subreg.sub1
    %3:sreg_64 = COPY %16

  bb.2:
    %4:vreg_64 = PHI %1, %bb.0, %3, %bb.1
    SI_END_CF %2, implicit-def dead $exec, implicit-def dead $scc, implicit $exec
    %17:vgpr_32 = COPY %4.sub0
    %18:vgpr_32 = COPY %4.sub1
    $vgpr0 = COPY %17
    $vgpr1 = COPY %18
    SI_RETURN implicit $vgpr0, implicit $vgpr1

...

