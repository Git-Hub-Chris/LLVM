; NOTE: Assertions have been autogenerated by utils/update_llc_test_checks.py UTC_ARGS: --version 5
; RUN: llc -mtriple=i386-linux-gnu -mattr=+cmov,+ndd < %s | FileCheck %s
define i64 @test(i64 %x, ptr %random) {
; CHECK-LABEL: test:
; CHECK:       # %bb.0: # %entry
; CHECK-NEXT:    pushl %esi
; CHECK-NEXT:    .cfi_def_cfa_offset 8
; CHECK-NEXT:    .cfi_offset %esi, -8
; CHECK-NEXT:    movl {{[0-9]+}}(%esp), %eax
; CHECK-NEXT:    movl {{[0-9]+}}(%esp), %edx
; CHECK-NEXT:    movl {{[0-9]+}}(%esp), %ecx
; CHECK-NEXT:    movzbl (%ecx), %ecx
; CHECK-NEXT:    movl %eax, %esi
; CHECK-NEXT:    shll %cl, %esi
; CHECK-NEXT:    shldl %cl, %eax, %edx
; CHECK-NEXT:    xorl %eax, %eax
; CHECK-NEXT:    testb $32, %cl
; CHECK-NEXT:    cmovnel %esi, %edx
; CHECK-NEXT:    cmovel %esi, %eax
; CHECK-NEXT:    popl %esi
; CHECK-NEXT:    .cfi_def_cfa_offset 4
; CHECK-NEXT:    retl
entry:
  %0 = load i32, ptr %random
  %sh_prom = zext nneg i32 %0 to i64
  %shl = shl i64 %x, %sh_prom
  ret i64 %shl
}
