; NOTE: Assertions have been autogenerated by utils/update_test_checks.py UTC_ARGS: --version 5
; RUN: opt -S -mtriple=amdgcn-amd-amdhsa -passes=amdgpu-promote-alloca < %s | FileCheck %s

define void @vector_alloca_with_loaded_value_as_index(<2 x i64> %arg) {
; CHECK-LABEL: define void @vector_alloca_with_loaded_value_as_index(
; CHECK-SAME: <2 x i64> [[ARG:%.*]]) {
; CHECK-NEXT:    [[TMP1:%.*]] = extractelement <2 x i64> [[ARG]], i64 0
; CHECK-NEXT:    [[TMP2:%.*]] = extractelement <2 x i64> [[ARG]], i64 1
; CHECK-NEXT:    ret void
;
  %alloca = alloca <2 x i64>, align 16
  %idx = load i64, ptr %alloca, align 4
  %gep = getelementptr <1 x double>, ptr %alloca, i64 %idx
  store <2 x i64> %arg, ptr %gep, align 16
  ret void
}
