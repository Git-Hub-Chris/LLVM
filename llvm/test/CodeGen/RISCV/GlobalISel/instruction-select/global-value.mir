# NOTE: Assertions have been autogenerated by utils/update_mir_test_checks.py UTC_ARGS: --version 3
# RUN: llc -mtriple=riscv64 -run-pass=instruction-select -code-model=small \
# RUN:   %s -o - | FileCheck --check-prefix=RV64-SMALL %s
# RUN: llc -mtriple=riscv64 -run-pass=instruction-select -code-model=medium \
# RUN:   %s -o - | FileCheck --check-prefix=RV64-MED %s

--- |
  @x = global i32 0, align 4
  define ptr @global_addr() {
  entry:
    ret ptr @x
  }
  @y = external global i32, align 4
  define ptr @extern_global_addr() {
  entry:
    ret ptr @y
  }
...
---
name:            global_addr
legalized:       true
regBankSelected: true
tracksRegLiveness: true
registers:
  - { id: 0, class: gprb, preferred-register: '' }
body:             |
  bb.1.entry:
    ; RV64-SMALL-LABEL: name: global_addr
    ; RV64-SMALL: [[LUI:%[0-9]+]]:gpr = LUI @x + 4
    ; RV64-SMALL-NEXT: [[ADDI:%[0-9]+]]:gpr = ADDI [[LUI]], target-flags(riscv-lo) @x
    ; RV64-SMALL-NEXT: $x10 = COPY [[ADDI]]
    ; RV64-SMALL-NEXT: PseudoRET implicit $x10
    ;
    ; RV64-MED-LABEL: name: global_addr
    ; RV64-MED: [[PseudoLLA:%[0-9]+]]:gpr = PseudoLLA @x
    ; RV64-MED-NEXT: $x10 = COPY [[PseudoLLA]]
    ; RV64-MED-NEXT: PseudoRET implicit $x10
    %0:gprb(p0) = G_GLOBAL_VALUE @x
    $x10 = COPY %0(p0)
    PseudoRET implicit $x10
...
---
name:            extern_global_addr
legalized:       true
regBankSelected: true
tracksRegLiveness: true
registers:
  - { id: 0, class: gprb, preferred-register: '' }
body:             |
  bb.1.entry:
    ; RV64-SMALL-LABEL: name: extern_global_addr
    ; RV64-SMALL: [[LUI:%[0-9]+]]:gpr = LUI @y + 4
    ; RV64-SMALL-NEXT: [[ADDI:%[0-9]+]]:gpr = ADDI [[LUI]], target-flags(riscv-lo) @y
    ; RV64-SMALL-NEXT: $x10 = COPY [[ADDI]]
    ; RV64-SMALL-NEXT: PseudoRET implicit $x10
    ;
    ; RV64-MED-LABEL: name: extern_global_addr
    ; RV64-MED: [[PseudoLLA:%[0-9]+]]:gpr = PseudoLLA @y
    ; RV64-MED-NEXT: $x10 = COPY [[PseudoLLA]]
    ; RV64-MED-NEXT: PseudoRET implicit $x10
    %0:gprb(p0) = G_GLOBAL_VALUE @y
    $x10 = COPY %0(p0)
    PseudoRET implicit $x10
...

