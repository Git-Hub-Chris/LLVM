; NOTE: Assertions have been autogenerated by utils/update_llc_test_checks.py
; RUN: llc -mtriple=aarch64-unknown-linux-gnu -O0 -global-isel=0 -o - < %s | FileCheck %s --check-prefixes=CHECK,CHECK-SD
; RUN: llc -mtriple=aarch64-unknown-linux-gnu -O0 -global-isel=1 -global-isel-abort=1 -o - < %s | FileCheck %s --check-prefixes=CHECK,CHECK-GI

target datalayout = "e-m:e-i8:8:32-i16:16:32-i64:64-i128:128-n32:64-S128-Fn32"

%struct.__va_list = type { ptr, ptr, ptr, i32, i32 }

declare void @llvm.va_start(ptr) nounwind
declare void @llvm.va_end(ptr) nounwind
declare void @llvm.lifetime.start.p0(i64 immarg, ptr nocapture)
declare void @llvm.va_start.p0(ptr)
declare void @llvm.va_end.p0(ptr)
declare void @llvm.lifetime.end.p0(i64 immarg, ptr nocapture)

; To make the outputs more readable
attributes #0 = { uwtable "frame-pointer"="all" }

define i64 @vararg(...) #0 {
; CHECK-SD-LABEL: vararg:
; CHECK-SD:       // %bb.0: // %entry
; CHECK-SD-NEXT:    sub sp, sp, #224
; CHECK-SD-NEXT:    .cfi_def_cfa_offset 224
; CHECK-SD-NEXT:    stp x29, x30, [sp, #208] // 16-byte Folded Spill
; CHECK-SD-NEXT:    add x29, sp, #208
; CHECK-SD-NEXT:    .cfi_def_cfa w29, 16
; CHECK-SD-NEXT:    .cfi_offset w30, -8
; CHECK-SD-NEXT:    .cfi_offset w29, -16
; CHECK-SD-NEXT:    str q7, [sp, #112]
; CHECK-SD-NEXT:    str q6, [sp, #96]
; CHECK-SD-NEXT:    str q5, [sp, #80]
; CHECK-SD-NEXT:    str q4, [sp, #64]
; CHECK-SD-NEXT:    str q3, [sp, #48]
; CHECK-SD-NEXT:    str q2, [sp, #32]
; CHECK-SD-NEXT:    str q1, [sp, #16]
; CHECK-SD-NEXT:    str q0, [sp]
; CHECK-SD-NEXT:    stur x7, [x29, #-16]
; CHECK-SD-NEXT:    stur x6, [x29, #-24]
; CHECK-SD-NEXT:    stur x5, [x29, #-32]
; CHECK-SD-NEXT:    stur x4, [x29, #-40]
; CHECK-SD-NEXT:    stur x3, [x29, #-48]
; CHECK-SD-NEXT:    stur x2, [x29, #-56]
; CHECK-SD-NEXT:    stur x1, [x29, #-64]
; CHECK-SD-NEXT:    stur x0, [x29, #-72]
; CHECK-SD-NEXT:    mov w8, #-128 // =0xffffff80
; CHECK-SD-NEXT:    str w8, [x29, #20]
; CHECK-SD-NEXT:    mov w8, #-64 // =0xffffffc0
; CHECK-SD-NEXT:    str w8, [x29, #16]
; CHECK-SD-NEXT:    add x8, x29, #16
; CHECK-SD-NEXT:    stur x8, [x29, #-8]
; CHECK-SD-NEXT:    mov x8, sp
; CHECK-SD-NEXT:    add x8, x8, #128
; CHECK-SD-NEXT:    str x8, [x29, #8]
; CHECK-SD-NEXT:    sub x8, x29, #72
; CHECK-SD-NEXT:    add x8, x8, #64
; CHECK-SD-NEXT:    str x8, [x29]
; CHECK-SD-NEXT:    mov w8, #1 // =0x1
; CHECK-SD-NEXT:    mov w0, w8
; CHECK-SD-NEXT:    .cfi_def_cfa wsp, 224
; CHECK-SD-NEXT:    ldp x29, x30, [sp, #208] // 16-byte Folded Reload
; CHECK-SD-NEXT:    add sp, sp, #224
; CHECK-SD-NEXT:    .cfi_def_cfa_offset 0
; CHECK-SD-NEXT:    .cfi_restore w30
; CHECK-SD-NEXT:    .cfi_restore w29
; CHECK-SD-NEXT:    ret
;
; CHECK-GI-LABEL: vararg:
; CHECK-GI:       // %bb.0: // %entry
; CHECK-GI-NEXT:    sub sp, sp, #224
; CHECK-GI-NEXT:    .cfi_def_cfa_offset 224
; CHECK-GI-NEXT:    stp x29, x30, [sp, #208] // 16-byte Folded Spill
; CHECK-GI-NEXT:    add x29, sp, #208
; CHECK-GI-NEXT:    .cfi_def_cfa w29, 16
; CHECK-GI-NEXT:    .cfi_offset w30, -8
; CHECK-GI-NEXT:    .cfi_offset w29, -16
; CHECK-GI-NEXT:    stur x0, [x29, #-64]
; CHECK-GI-NEXT:    stur x1, [x29, #-56]
; CHECK-GI-NEXT:    stur x2, [x29, #-48]
; CHECK-GI-NEXT:    stur x3, [x29, #-40]
; CHECK-GI-NEXT:    stur x4, [x29, #-32]
; CHECK-GI-NEXT:    stur x5, [x29, #-24]
; CHECK-GI-NEXT:    stur x6, [x29, #-16]
; CHECK-GI-NEXT:    stur x7, [x29, #-8]
; CHECK-GI-NEXT:    str q0, [sp, #16]
; CHECK-GI-NEXT:    str q1, [sp, #32]
; CHECK-GI-NEXT:    str q2, [sp, #48]
; CHECK-GI-NEXT:    str q3, [sp, #64]
; CHECK-GI-NEXT:    str q4, [sp, #80]
; CHECK-GI-NEXT:    str q5, [sp, #96]
; CHECK-GI-NEXT:    str q6, [sp, #112]
; CHECK-GI-NEXT:    str q7, [sp, #128]
; CHECK-GI-NEXT:    add x9, sp, #8
; CHECK-GI-NEXT:    add x8, x29, #16
; CHECK-GI-NEXT:    str x8, [x9]
; CHECK-GI-NEXT:    add x8, x29, #0
; CHECK-GI-NEXT:    str x8, [x9, #8]
; CHECK-GI-NEXT:    add x8, sp, #144
; CHECK-GI-NEXT:    str x8, [x9, #16]
; CHECK-GI-NEXT:    mov w8, #-64 // =0xffffffc0
; CHECK-GI-NEXT:    str w8, [x9, #24]
; CHECK-GI-NEXT:    mov w8, #-128 // =0xffffff80
; CHECK-GI-NEXT:    str w8, [x9, #28]
; CHECK-GI-NEXT:    mov w8, #1 // =0x1
; CHECK-GI-NEXT:    mov w0, w8
; CHECK-GI-NEXT:    .cfi_def_cfa wsp, 224
; CHECK-GI-NEXT:    ldp x29, x30, [sp, #208] // 16-byte Folded Reload
; CHECK-GI-NEXT:    add sp, sp, #224
; CHECK-GI-NEXT:    .cfi_def_cfa_offset 0
; CHECK-GI-NEXT:    .cfi_restore w30
; CHECK-GI-NEXT:    .cfi_restore w29
; CHECK-GI-NEXT:    ret
entry:
  %g = alloca ptr, align 4
  call void @llvm.va_start(ptr %g)
  ret i64 1
}

define i64 @vararg_many_gpr(i64 %a1, i64 %a2, i64 %a3, i64 %a4, i64 %a5, i64 %a6, i64 %a7, ...) #0 {
; CHECK-SD-LABEL: vararg_many_gpr:
; CHECK-SD:       // %bb.0: // %entry
; CHECK-SD-NEXT:    sub sp, sp, #160
; CHECK-SD-NEXT:    .cfi_def_cfa_offset 160
; CHECK-SD-NEXT:    stp x29, x30, [sp, #144] // 16-byte Folded Spill
; CHECK-SD-NEXT:    add x29, sp, #144
; CHECK-SD-NEXT:    .cfi_def_cfa w29, 16
; CHECK-SD-NEXT:    .cfi_offset w30, -8
; CHECK-SD-NEXT:    .cfi_offset w29, -16
; CHECK-SD-NEXT:    str q7, [sp, #112]
; CHECK-SD-NEXT:    str q6, [sp, #96]
; CHECK-SD-NEXT:    str q5, [sp, #80]
; CHECK-SD-NEXT:    str q4, [sp, #64]
; CHECK-SD-NEXT:    str q3, [sp, #48]
; CHECK-SD-NEXT:    str q2, [sp, #32]
; CHECK-SD-NEXT:    str q1, [sp, #16]
; CHECK-SD-NEXT:    str q0, [sp]
; CHECK-SD-NEXT:    stur x7, [x29, #-16]
; CHECK-SD-NEXT:    mov w8, #-128 // =0xffffff80
; CHECK-SD-NEXT:    str w8, [x29, #20]
; CHECK-SD-NEXT:    mov w8, #-8 // =0xfffffff8
; CHECK-SD-NEXT:    str w8, [x29, #16]
; CHECK-SD-NEXT:    add x8, x29, #16
; CHECK-SD-NEXT:    stur x8, [x29, #-8]
; CHECK-SD-NEXT:    mov x8, sp
; CHECK-SD-NEXT:    add x8, x8, #128
; CHECK-SD-NEXT:    str x8, [x29, #8]
; CHECK-SD-NEXT:    sub x8, x29, #16
; CHECK-SD-NEXT:    add x8, x8, #8
; CHECK-SD-NEXT:    str x8, [x29]
; CHECK-SD-NEXT:    mov w8, #1 // =0x1
; CHECK-SD-NEXT:    mov w0, w8
; CHECK-SD-NEXT:    .cfi_def_cfa wsp, 160
; CHECK-SD-NEXT:    ldp x29, x30, [sp, #144] // 16-byte Folded Reload
; CHECK-SD-NEXT:    add sp, sp, #160
; CHECK-SD-NEXT:    .cfi_def_cfa_offset 0
; CHECK-SD-NEXT:    .cfi_restore w30
; CHECK-SD-NEXT:    .cfi_restore w29
; CHECK-SD-NEXT:    ret
;
; CHECK-GI-LABEL: vararg_many_gpr:
; CHECK-GI:       // %bb.0: // %entry
; CHECK-GI-NEXT:    sub sp, sp, #176
; CHECK-GI-NEXT:    .cfi_def_cfa_offset 176
; CHECK-GI-NEXT:    stp x29, x30, [sp, #160] // 16-byte Folded Spill
; CHECK-GI-NEXT:    add x29, sp, #160
; CHECK-GI-NEXT:    .cfi_def_cfa w29, 16
; CHECK-GI-NEXT:    .cfi_offset w30, -8
; CHECK-GI-NEXT:    .cfi_offset w29, -16
; CHECK-GI-NEXT:    stur x7, [x29, #-8]
; CHECK-GI-NEXT:    str q0, [sp, #16]
; CHECK-GI-NEXT:    str q1, [sp, #32]
; CHECK-GI-NEXT:    str q2, [sp, #48]
; CHECK-GI-NEXT:    str q3, [sp, #64]
; CHECK-GI-NEXT:    str q4, [sp, #80]
; CHECK-GI-NEXT:    str q5, [sp, #96]
; CHECK-GI-NEXT:    str q6, [sp, #112]
; CHECK-GI-NEXT:    str q7, [sp, #128]
; CHECK-GI-NEXT:    add x9, sp, #8
; CHECK-GI-NEXT:    add x8, x29, #16
; CHECK-GI-NEXT:    str x8, [x9]
; CHECK-GI-NEXT:    add x8, x29, #0
; CHECK-GI-NEXT:    str x8, [x9, #8]
; CHECK-GI-NEXT:    add x8, sp, #144
; CHECK-GI-NEXT:    str x8, [x9, #16]
; CHECK-GI-NEXT:    mov w8, #-8 // =0xfffffff8
; CHECK-GI-NEXT:    str w8, [x9, #24]
; CHECK-GI-NEXT:    mov w8, #-128 // =0xffffff80
; CHECK-GI-NEXT:    str w8, [x9, #28]
; CHECK-GI-NEXT:    mov w8, #1 // =0x1
; CHECK-GI-NEXT:    mov w0, w8
; CHECK-GI-NEXT:    .cfi_def_cfa wsp, 176
; CHECK-GI-NEXT:    ldp x29, x30, [sp, #160] // 16-byte Folded Reload
; CHECK-GI-NEXT:    add sp, sp, #176
; CHECK-GI-NEXT:    .cfi_def_cfa_offset 0
; CHECK-GI-NEXT:    .cfi_restore w30
; CHECK-GI-NEXT:    .cfi_restore w29
; CHECK-GI-NEXT:    ret
entry:
  %g = alloca ptr, align 4
  call void @llvm.va_start(ptr %g)
  ret i64 1
}

define i64 @vararg_many_float(float %a1, float %a2, float %a3, float %a4, float %a5, float %a6, float %a7, ...) #0 {
; CHECK-SD-LABEL: vararg_many_float:
; CHECK-SD:       // %bb.0: // %entry
; CHECK-SD-NEXT:    sub sp, sp, #112
; CHECK-SD-NEXT:    .cfi_def_cfa_offset 112
; CHECK-SD-NEXT:    stp x29, x30, [sp, #96] // 16-byte Folded Spill
; CHECK-SD-NEXT:    add x29, sp, #96
; CHECK-SD-NEXT:    .cfi_def_cfa w29, 16
; CHECK-SD-NEXT:    .cfi_offset w30, -8
; CHECK-SD-NEXT:    .cfi_offset w29, -16
; CHECK-SD-NEXT:    str q7, [sp]
; CHECK-SD-NEXT:    str x7, [sp, #80]
; CHECK-SD-NEXT:    str x6, [sp, #72]
; CHECK-SD-NEXT:    str x5, [sp, #64]
; CHECK-SD-NEXT:    str x4, [sp, #56]
; CHECK-SD-NEXT:    str x3, [sp, #48]
; CHECK-SD-NEXT:    str x2, [sp, #40]
; CHECK-SD-NEXT:    str x1, [sp, #32]
; CHECK-SD-NEXT:    str x0, [sp, #24]
; CHECK-SD-NEXT:    mov w8, #-16 // =0xfffffff0
; CHECK-SD-NEXT:    str w8, [x29, #20]
; CHECK-SD-NEXT:    mov w8, #-64 // =0xffffffc0
; CHECK-SD-NEXT:    str w8, [x29, #16]
; CHECK-SD-NEXT:    add x8, x29, #16
; CHECK-SD-NEXT:    stur x8, [x29, #-8]
; CHECK-SD-NEXT:    mov x8, sp
; CHECK-SD-NEXT:    add x8, x8, #16
; CHECK-SD-NEXT:    str x8, [x29, #8]
; CHECK-SD-NEXT:    add x8, sp, #24
; CHECK-SD-NEXT:    add x8, x8, #64
; CHECK-SD-NEXT:    str x8, [x29]
; CHECK-SD-NEXT:    mov w8, #1 // =0x1
; CHECK-SD-NEXT:    mov w0, w8
; CHECK-SD-NEXT:    .cfi_def_cfa wsp, 112
; CHECK-SD-NEXT:    ldp x29, x30, [sp, #96] // 16-byte Folded Reload
; CHECK-SD-NEXT:    add sp, sp, #112
; CHECK-SD-NEXT:    .cfi_def_cfa_offset 0
; CHECK-SD-NEXT:    .cfi_restore w30
; CHECK-SD-NEXT:    .cfi_restore w29
; CHECK-SD-NEXT:    ret
;
; CHECK-GI-LABEL: vararg_many_float:
; CHECK-GI:       // %bb.0: // %entry
; CHECK-GI-NEXT:    sub sp, sp, #112
; CHECK-GI-NEXT:    .cfi_def_cfa_offset 112
; CHECK-GI-NEXT:    stp x29, x30, [sp, #96] // 16-byte Folded Spill
; CHECK-GI-NEXT:    add x29, sp, #96
; CHECK-GI-NEXT:    .cfi_def_cfa w29, 16
; CHECK-GI-NEXT:    .cfi_offset w30, -8
; CHECK-GI-NEXT:    .cfi_offset w29, -16
; CHECK-GI-NEXT:    str x0, [sp, #32]
; CHECK-GI-NEXT:    str x1, [sp, #40]
; CHECK-GI-NEXT:    str x2, [sp, #48]
; CHECK-GI-NEXT:    str x3, [sp, #56]
; CHECK-GI-NEXT:    str x4, [sp, #64]
; CHECK-GI-NEXT:    str x5, [sp, #72]
; CHECK-GI-NEXT:    str x6, [sp, #80]
; CHECK-GI-NEXT:    str x7, [sp, #88]
; CHECK-GI-NEXT:    str q7, [sp, #16]
; CHECK-GI-NEXT:    add x9, sp, #8
; CHECK-GI-NEXT:    add x8, x29, #16
; CHECK-GI-NEXT:    str x8, [x9]
; CHECK-GI-NEXT:    add x8, sp, #96
; CHECK-GI-NEXT:    str x8, [x9, #8]
; CHECK-GI-NEXT:    add x8, sp, #32
; CHECK-GI-NEXT:    str x8, [x9, #16]
; CHECK-GI-NEXT:    mov w8, #-64 // =0xffffffc0
; CHECK-GI-NEXT:    str w8, [x9, #24]
; CHECK-GI-NEXT:    mov w8, #-16 // =0xfffffff0
; CHECK-GI-NEXT:    str w8, [x9, #28]
; CHECK-GI-NEXT:    mov w8, #1 // =0x1
; CHECK-GI-NEXT:    mov w0, w8
; CHECK-GI-NEXT:    .cfi_def_cfa wsp, 112
; CHECK-GI-NEXT:    ldp x29, x30, [sp, #96] // 16-byte Folded Reload
; CHECK-GI-NEXT:    add sp, sp, #112
; CHECK-GI-NEXT:    .cfi_def_cfa_offset 0
; CHECK-GI-NEXT:    .cfi_restore w30
; CHECK-GI-NEXT:    .cfi_restore w29
; CHECK-GI-NEXT:    ret
entry:
  %g = alloca ptr, align 4
  call void @llvm.va_start(ptr %g)
  ret i64 1
}

define i64 @gpr1_fpr1(i32 %i, float %f, ...) #0 {
; CHECK-SD-LABEL: gpr1_fpr1:
; CHECK-SD:       // %bb.0: // %entry
; CHECK-SD-NEXT:    sub sp, sp, #192
; CHECK-SD-NEXT:    .cfi_def_cfa_offset 192
; CHECK-SD-NEXT:    stp x29, x30, [sp, #176] // 16-byte Folded Spill
; CHECK-SD-NEXT:    add x29, sp, #176
; CHECK-SD-NEXT:    .cfi_def_cfa w29, 16
; CHECK-SD-NEXT:    .cfi_offset w30, -8
; CHECK-SD-NEXT:    .cfi_offset w29, -16
; CHECK-SD-NEXT:    str q7, [sp, #96]
; CHECK-SD-NEXT:    str q6, [sp, #80]
; CHECK-SD-NEXT:    str q5, [sp, #64]
; CHECK-SD-NEXT:    str q4, [sp, #48]
; CHECK-SD-NEXT:    str q3, [sp, #32]
; CHECK-SD-NEXT:    str q2, [sp, #16]
; CHECK-SD-NEXT:    str q1, [sp]
; CHECK-SD-NEXT:    stur x7, [x29, #-16]
; CHECK-SD-NEXT:    stur x6, [x29, #-24]
; CHECK-SD-NEXT:    stur x5, [x29, #-32]
; CHECK-SD-NEXT:    stur x4, [x29, #-40]
; CHECK-SD-NEXT:    stur x3, [x29, #-48]
; CHECK-SD-NEXT:    stur x2, [x29, #-56]
; CHECK-SD-NEXT:    stur x1, [x29, #-64]
; CHECK-SD-NEXT:    mov w8, #-112 // =0xffffff90
; CHECK-SD-NEXT:    str w8, [x29, #20]
; CHECK-SD-NEXT:    mov w8, #-56 // =0xffffffc8
; CHECK-SD-NEXT:    str w8, [x29, #16]
; CHECK-SD-NEXT:    add x8, x29, #16
; CHECK-SD-NEXT:    stur x8, [x29, #-8]
; CHECK-SD-NEXT:    mov x8, sp
; CHECK-SD-NEXT:    add x8, x8, #112
; CHECK-SD-NEXT:    str x8, [x29, #8]
; CHECK-SD-NEXT:    sub x8, x29, #64
; CHECK-SD-NEXT:    add x8, x8, #56
; CHECK-SD-NEXT:    str x8, [x29]
; CHECK-SD-NEXT:    mov w8, #1 // =0x1
; CHECK-SD-NEXT:    mov w0, w8
; CHECK-SD-NEXT:    .cfi_def_cfa wsp, 192
; CHECK-SD-NEXT:    ldp x29, x30, [sp, #176] // 16-byte Folded Reload
; CHECK-SD-NEXT:    add sp, sp, #192
; CHECK-SD-NEXT:    .cfi_def_cfa_offset 0
; CHECK-SD-NEXT:    .cfi_restore w30
; CHECK-SD-NEXT:    .cfi_restore w29
; CHECK-SD-NEXT:    ret
;
; CHECK-GI-LABEL: gpr1_fpr1:
; CHECK-GI:       // %bb.0: // %entry
; CHECK-GI-NEXT:    sub sp, sp, #208
; CHECK-GI-NEXT:    .cfi_def_cfa_offset 208
; CHECK-GI-NEXT:    stp x29, x30, [sp, #192] // 16-byte Folded Spill
; CHECK-GI-NEXT:    add x29, sp, #192
; CHECK-GI-NEXT:    .cfi_def_cfa w29, 16
; CHECK-GI-NEXT:    .cfi_offset w30, -8
; CHECK-GI-NEXT:    .cfi_offset w29, -16
; CHECK-GI-NEXT:    stur x1, [x29, #-56]
; CHECK-GI-NEXT:    stur x2, [x29, #-48]
; CHECK-GI-NEXT:    stur x3, [x29, #-40]
; CHECK-GI-NEXT:    stur x4, [x29, #-32]
; CHECK-GI-NEXT:    stur x5, [x29, #-24]
; CHECK-GI-NEXT:    stur x6, [x29, #-16]
; CHECK-GI-NEXT:    stur x7, [x29, #-8]
; CHECK-GI-NEXT:    str q1, [sp, #16]
; CHECK-GI-NEXT:    str q2, [sp, #32]
; CHECK-GI-NEXT:    str q3, [sp, #48]
; CHECK-GI-NEXT:    str q4, [sp, #64]
; CHECK-GI-NEXT:    str q5, [sp, #80]
; CHECK-GI-NEXT:    str q6, [sp, #96]
; CHECK-GI-NEXT:    str q7, [sp, #112]
; CHECK-GI-NEXT:    add x9, sp, #8
; CHECK-GI-NEXT:    add x8, x29, #16
; CHECK-GI-NEXT:    str x8, [x9]
; CHECK-GI-NEXT:    add x8, x29, #0
; CHECK-GI-NEXT:    str x8, [x9, #8]
; CHECK-GI-NEXT:    add x8, sp, #128
; CHECK-GI-NEXT:    str x8, [x9, #16]
; CHECK-GI-NEXT:    mov w8, #-56 // =0xffffffc8
; CHECK-GI-NEXT:    str w8, [x9, #24]
; CHECK-GI-NEXT:    mov w8, #-112 // =0xffffff90
; CHECK-GI-NEXT:    str w8, [x9, #28]
; CHECK-GI-NEXT:    mov w8, #1 // =0x1
; CHECK-GI-NEXT:    mov w0, w8
; CHECK-GI-NEXT:    .cfi_def_cfa wsp, 208
; CHECK-GI-NEXT:    ldp x29, x30, [sp, #192] // 16-byte Folded Reload
; CHECK-GI-NEXT:    add sp, sp, #208
; CHECK-GI-NEXT:    .cfi_def_cfa_offset 0
; CHECK-GI-NEXT:    .cfi_restore w30
; CHECK-GI-NEXT:    .cfi_restore w29
; CHECK-GI-NEXT:    ret
entry:
  %g = alloca ptr, align 4
  call void @llvm.va_start(ptr %g)
  ret i64 1
}

; A real program case
define float @vararg_program(ptr %a, ...) #0 {
; CHECK-SD-LABEL: vararg_program:
; CHECK-SD:       // %bb.0: // %entry
; CHECK-SD-NEXT:    sub sp, sp, #272
; CHECK-SD-NEXT:    .cfi_def_cfa_offset 272
; CHECK-SD-NEXT:    stp x29, x30, [sp, #256] // 16-byte Folded Spill
; CHECK-SD-NEXT:    add x29, sp, #256
; CHECK-SD-NEXT:    .cfi_def_cfa w29, 16
; CHECK-SD-NEXT:    .cfi_offset w30, -8
; CHECK-SD-NEXT:    .cfi_offset w29, -16
; CHECK-SD-NEXT:    str q7, [sp, #144]
; CHECK-SD-NEXT:    str q6, [sp, #128]
; CHECK-SD-NEXT:    str q5, [sp, #112]
; CHECK-SD-NEXT:    str q4, [sp, #96]
; CHECK-SD-NEXT:    str q3, [sp, #80]
; CHECK-SD-NEXT:    str q2, [sp, #64]
; CHECK-SD-NEXT:    str q1, [sp, #48]
; CHECK-SD-NEXT:    str q0, [sp, #32]
; CHECK-SD-NEXT:    stur x7, [x29, #-40]
; CHECK-SD-NEXT:    stur x6, [x29, #-48]
; CHECK-SD-NEXT:    stur x5, [x29, #-56]
; CHECK-SD-NEXT:    stur x4, [x29, #-64]
; CHECK-SD-NEXT:    stur x3, [x29, #-72]
; CHECK-SD-NEXT:    stur x2, [x29, #-80]
; CHECK-SD-NEXT:    stur x1, [x29, #-88]
; CHECK-SD-NEXT:    mov w8, #-128 // =0xffffff80
; CHECK-SD-NEXT:    stur w8, [x29, #-4]
; CHECK-SD-NEXT:    mov w8, #-56 // =0xffffffc8
; CHECK-SD-NEXT:    stur w8, [x29, #-8]
; CHECK-SD-NEXT:    add x8, x29, #16
; CHECK-SD-NEXT:    stur x8, [x29, #-32]
; CHECK-SD-NEXT:    add x8, sp, #32
; CHECK-SD-NEXT:    add x8, x8, #128
; CHECK-SD-NEXT:    stur x8, [x29, #-16]
; CHECK-SD-NEXT:    sub x8, x29, #88
; CHECK-SD-NEXT:    add x8, x8, #56
; CHECK-SD-NEXT:    stur x8, [x29, #-24]
; CHECK-SD-NEXT:    sub x8, x29, #32
; CHECK-SD-NEXT:    add x8, x8, #28
; CHECK-SD-NEXT:    str x8, [sp, #16] // 8-byte Folded Spill
; CHECK-SD-NEXT:    ldur w8, [x29, #-4]
; CHECK-SD-NEXT:    str w8, [sp, #28] // 4-byte Folded Spill
; CHECK-SD-NEXT:    tbz w8, #31, .LBB4_3
; CHECK-SD-NEXT:  // %bb.1: // %vaarg.maybe_reg
; CHECK-SD-NEXT:    ldr w8, [sp, #28] // 4-byte Folded Reload
; CHECK-SD-NEXT:    ldr x10, [sp, #16] // 8-byte Folded Reload
; CHECK-SD-NEXT:    add w9, w8, #16
; CHECK-SD-NEXT:    str w9, [x10]
; CHECK-SD-NEXT:    mov w9, #-15 // =0xfffffff1
; CHECK-SD-NEXT:    cmp w8, w9
; CHECK-SD-NEXT:    b.hs .LBB4_3
; CHECK-SD-NEXT:  // %bb.2: // %vaarg.in_reg
; CHECK-SD-NEXT:    ldr w9, [sp, #28] // 4-byte Folded Reload
; CHECK-SD-NEXT:    ldur x8, [x29, #-16]
; CHECK-SD-NEXT:    // kill: def $x9 killed $w9
; CHECK-SD-NEXT:    sxtw x9, w9
; CHECK-SD-NEXT:    add x8, x8, x9
; CHECK-SD-NEXT:    str x8, [sp, #8] // 8-byte Folded Spill
; CHECK-SD-NEXT:    b .LBB4_4
; CHECK-SD-NEXT:  .LBB4_3: // %vaarg.on_stack
; CHECK-SD-NEXT:    ldur x8, [x29, #-32]
; CHECK-SD-NEXT:    add x9, x8, #8
; CHECK-SD-NEXT:    stur x9, [x29, #-32]
; CHECK-SD-NEXT:    str x8, [sp, #8] // 8-byte Folded Spill
; CHECK-SD-NEXT:  .LBB4_4: // %vaarg.end
; CHECK-SD-NEXT:    ldr x8, [sp, #8] // 8-byte Folded Reload
; CHECK-SD-NEXT:    ldr d0, [x8]
; CHECK-SD-NEXT:    fcvt s0, d0
; CHECK-SD-NEXT:    .cfi_def_cfa wsp, 272
; CHECK-SD-NEXT:    ldp x29, x30, [sp, #256] // 16-byte Folded Reload
; CHECK-SD-NEXT:    add sp, sp, #272
; CHECK-SD-NEXT:    .cfi_def_cfa_offset 0
; CHECK-SD-NEXT:    .cfi_restore w30
; CHECK-SD-NEXT:    .cfi_restore w29
; CHECK-SD-NEXT:    ret
;
; CHECK-GI-LABEL: vararg_program:
; CHECK-GI:       // %bb.0: // %entry
; CHECK-GI-NEXT:    sub sp, sp, #256
; CHECK-GI-NEXT:    .cfi_def_cfa_offset 256
; CHECK-GI-NEXT:    stp x29, x30, [sp, #240] // 16-byte Folded Spill
; CHECK-GI-NEXT:    add x29, sp, #240
; CHECK-GI-NEXT:    .cfi_def_cfa w29, 16
; CHECK-GI-NEXT:    .cfi_offset w30, -8
; CHECK-GI-NEXT:    .cfi_offset w29, -16
; CHECK-GI-NEXT:    stur x1, [x29, #-56]
; CHECK-GI-NEXT:    stur x2, [x29, #-48]
; CHECK-GI-NEXT:    stur x3, [x29, #-40]
; CHECK-GI-NEXT:    stur x4, [x29, #-32]
; CHECK-GI-NEXT:    stur x5, [x29, #-24]
; CHECK-GI-NEXT:    stur x6, [x29, #-16]
; CHECK-GI-NEXT:    stur x7, [x29, #-8]
; CHECK-GI-NEXT:    str q0, [sp, #48]
; CHECK-GI-NEXT:    str q1, [sp, #64]
; CHECK-GI-NEXT:    str q2, [sp, #80]
; CHECK-GI-NEXT:    str q3, [sp, #96]
; CHECK-GI-NEXT:    str q4, [sp, #112]
; CHECK-GI-NEXT:    str q5, [sp, #128]
; CHECK-GI-NEXT:    str q6, [sp, #144]
; CHECK-GI-NEXT:    str q7, [sp, #160]
; CHECK-GI-NEXT:    add x9, sp, #16
; CHECK-GI-NEXT:    add x8, x29, #16
; CHECK-GI-NEXT:    str x8, [x9]
; CHECK-GI-NEXT:    add x8, x29, #0
; CHECK-GI-NEXT:    str x8, [x9, #8]
; CHECK-GI-NEXT:    add x8, sp, #176
; CHECK-GI-NEXT:    str x8, [x9, #16]
; CHECK-GI-NEXT:    mov w8, #-56 // =0xffffffc8
; CHECK-GI-NEXT:    str w8, [x9, #24]
; CHECK-GI-NEXT:    mov w8, #-128 // =0xffffff80
; CHECK-GI-NEXT:    str w8, [x9, #28]
; CHECK-GI-NEXT:    ldrsw x8, [sp, #44]
; CHECK-GI-NEXT:    str x8, [sp, #8] // 8-byte Folded Spill
; CHECK-GI-NEXT:    tbz w8, #31, .LBB4_3
; CHECK-GI-NEXT:    b .LBB4_1
; CHECK-GI-NEXT:  .LBB4_1: // %vaarg.maybe_reg
; CHECK-GI-NEXT:    ldr x8, [sp, #8] // 8-byte Folded Reload
; CHECK-GI-NEXT:    add w9, w8, #16
; CHECK-GI-NEXT:    str w9, [sp, #44]
; CHECK-GI-NEXT:    adds w8, w8, #15
; CHECK-GI-NEXT:    b.hs .LBB4_3
; CHECK-GI-NEXT:    b .LBB4_2
; CHECK-GI-NEXT:  .LBB4_2: // %vaarg.in_reg
; CHECK-GI-NEXT:    ldr x9, [sp, #8] // 8-byte Folded Reload
; CHECK-GI-NEXT:    ldr x8, [sp, #32]
; CHECK-GI-NEXT:    add x8, x8, x9
; CHECK-GI-NEXT:    str x8, [sp] // 8-byte Folded Spill
; CHECK-GI-NEXT:    b .LBB4_4
; CHECK-GI-NEXT:  .LBB4_3: // %vaarg.on_stack
; CHECK-GI-NEXT:    ldr x8, [sp, #16]
; CHECK-GI-NEXT:    mov x9, x8
; CHECK-GI-NEXT:    add x9, x9, #8
; CHECK-GI-NEXT:    str x9, [sp, #16]
; CHECK-GI-NEXT:    str x8, [sp] // 8-byte Folded Spill
; CHECK-GI-NEXT:    b .LBB4_4
; CHECK-GI-NEXT:  .LBB4_4: // %vaarg.end
; CHECK-GI-NEXT:    ldr x8, [sp] // 8-byte Folded Reload
; CHECK-GI-NEXT:    ldr d0, [x8]
; CHECK-GI-NEXT:    fcvt s0, d0
; CHECK-GI-NEXT:    .cfi_def_cfa wsp, 256
; CHECK-GI-NEXT:    ldp x29, x30, [sp, #240] // 16-byte Folded Reload
; CHECK-GI-NEXT:    add sp, sp, #256
; CHECK-GI-NEXT:    .cfi_def_cfa_offset 0
; CHECK-GI-NEXT:    .cfi_restore w30
; CHECK-GI-NEXT:    .cfi_restore w29
; CHECK-GI-NEXT:    ret
entry:
  %ap = alloca %struct.__va_list, align 8
  call void @llvm.lifetime.start.p0(i64 32, ptr nonnull %ap) #3
  call void @llvm.va_start.p0(ptr nonnull %ap)
  %vr_offs_p = getelementptr inbounds i8, ptr %ap, i64 28
  %vr_offs = load i32, ptr %vr_offs_p, align 4
  %0 = icmp sgt i32 %vr_offs, -1
  br i1 %0, label %vaarg.on_stack, label %vaarg.maybe_reg

vaarg.maybe_reg:                                  ; preds = %entry
  %new_reg_offs = add nsw i32 %vr_offs, 16
  store i32 %new_reg_offs, ptr %vr_offs_p, align 4
  %inreg = icmp ult i32 %vr_offs, -15
  br i1 %inreg, label %vaarg.in_reg, label %vaarg.on_stack

vaarg.in_reg:                                     ; preds = %vaarg.maybe_reg
  %reg_top_p = getelementptr inbounds i8, ptr %ap, i64 16
  %reg_top = load ptr, ptr %reg_top_p, align 8
  %1 = sext i32 %vr_offs to i64
  %2 = getelementptr inbounds i8, ptr %reg_top, i64 %1
  br label %vaarg.end

vaarg.on_stack:                                   ; preds = %vaarg.maybe_reg, %entry
  %stack = load ptr, ptr %ap, align 8
  %new_stack = getelementptr inbounds i8, ptr %stack, i64 8
  store ptr %new_stack, ptr %ap, align 8
  br label %vaarg.end

vaarg.end:                                        ; preds = %vaarg.on_stack, %vaarg.in_reg
  %vaargs.addr = phi ptr [ %2, %vaarg.in_reg ], [ %stack, %vaarg.on_stack ]
  %3 = load double, ptr %vaargs.addr, align 8
  %conv = fptrunc double %3 to float
  call void @llvm.va_end.p0(ptr nonnull %ap)
  call void @llvm.lifetime.end.p0(i64 32, ptr nonnull %ap)
  ret float %conv
}


;; NOTE: These prefixes are unused and the list is autogenerated. Do not add tests below this line:
; CHECK: {{.*}}
